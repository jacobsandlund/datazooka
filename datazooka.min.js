var binfo={numGroups:35,tickSpacing:46,compareHeightScale:.2,chartHeight:200,chartPadding:5,chartBorder:5,maxLevels:50,arrangeSnap:40,arrangeInsertFocalDiff:550,arrangeInsertMaxDiff:50,holderMargin:15,compareLevels:100,axisTickSize:12,axisLabelSize:14,fitWidthMaxDiff:220,chartDimensions:{top:16,right:10,bottom:20,left:10,height:100,width:100,binWidth:11}};binfo._register=function(){"use strict";function s(e){return t[e]=t[e]||o()}function o(){return{dependency:s}}var e=[],t={},n={},r={},i={};return function(o,u,a){function c(e){return!i[e]}function h(e){var s=r[e],o=n[e],u;if(i[e])return;if(o.some(c))return;u=[e].concat(o).map(function(e){return t[e]}),r[e].apply(null,u),i[e]=!0,l=!0}var f=e,l=!0;f.push(o),s(o),u.forEach(function(e){s(e)}),n[o]=u,r[o]=a,i[o]=!1;while(f.some(c)&&l)l=!1,f.forEach(h)}}(),binfo._register("core",[],function(e){function N(e,t){return e.filter(function(e){return t.indexOf(e)<0})}function C(){c!==null&&(clearTimeout(c),c=null)}function k(){c=setTimeout(function(){e.update("always")},700)}function L(){A(p,"filter"),A(p,"given"),A(p,"filterLevels"),p=null,d=!1}function A(e,t){var n,r=e[t];for(n in r)r.hasOwnProperty(n)&&T[n][t](r[n])}function O(){m=!1,v=!1,t.updated(b)}var t=e.dependency("ui"),n=e.dependency("rendering"),r=e.dependency("charts"),i=e.dependency("hash"),s=e.dependency("arrange"),o=e.dependency("stylesheet"),u={},a,f,l="always",c=null,h,p,d,v=!0,m,g,y,b,w=[],E,S,x,T;e.isMouseOut=function(){var e=d3.event,t=e.currentTarget,n;n=e.relatedTarget;if(n){while(n!==t&&n.nodeName!=="BODY"&&n.parentNode)n=n.parentNode;if(n===t)return!1}return!0},e.dataSet=function(n,i,s){var o,a;if(!i)return o=u[n],o?o:null;u[n]=o={definitions:i,data:s},o.definitionIds=[],o.charts={};for(a in i)i.hasOwnProperty(a)&&(o.charts[a]=r.barChart(i[a],s),o.definitionIds.push(a));o.chartIds=o.definitionIds.slice(),t.addDataName(n),h&&h[0]===n&&e.renderFresh.apply(null,h)},binfo.setup=function(e){var n=d3.select(e.holder).attr("class","outer-holder"),r=n.append("div"),i=d3.select(e.root);t.setup(r),s.setup(i,n,r),o.setup(r),i.on("mousemove.core",function(){c!==null&&(C(),k())})},e.dataName=function(e){if(!arguments.length)return b;if(e===b)return;v=!0,S=e,T=u[S].charts,x=[]},e.addChart=function(t){if(x.indexOf(t)>=0)return;e.chartIds(x.concat([t])),e.update()},e.removeChart=function(t){var n=x.slice();n.splice(n.indexOf(t),1),e.chartIds(n),e.update()},e.changeDataName=function(t){e.dataName(t),e.update()},e.clearCharts=function(){e.chartIds([]),e.update()},e.cancel=function(){S=b,T=E,x=w,O()},e.reorder=function(e){w=e},e.charts=function(){return E},e.chartIds=function(e){if(!arguments.length)return w;x=e,x.forEach(function(e){T[e]||(T[e]=r.compareChart({id:e,charts:T}))}),y=N(w,x),g=N(x,w);if(g.length||y.length)v=!0},binfo.defaultRender=function(t,n,r){h||e.renderFresh(t,n,r)},e.renderFresh=function(t,n,r){if(!u[t]){h=[t,n,r];return}e.dataName(t),e.chartIds(n),d=!0,p=r||{filters:{},given:{},filterLevels:{}},e.update("force")},e.updateMode=function(e){if(!arguments.length)return l;l=e},e.update=function(r){r||(r=l);if(!v&&r!=="force")return;if(r==="manual"){t.needsUpdate(!0);return}C();if(!a||S!==b||y.length||g.length){if(r==="smart"){t.needsUpdate(!0),k();return}if(!m){m=!0,t.updating(!0),setTimeout(function(){e.update(r)},30);return}}i.disable();var o=u[S].data,c=g,h=y;if(!a||S!==b||y.length)a=crossfilter(o),f=a.groupAll(),c=x,h=w,y.length||(g=c,y=h);d&&(g=x,y=w),h.forEach(function(e){E[e].removeCross()}),c.forEach(function(e){T[e].addCross(a,f)}),y.forEach(function(e){E[e].remove()}),g.forEach(function(e){T[e].add()}),n.render(x,T),d&&L(),n.refresh(f.value(),a.size()),s.remove(y,E),s.add(g,T),b=S,E=T,w=x,i.refresh(b,w,E),O()},e.refresh=function(){n.refresh(f.value(),a.size()),i.refresh(b,w,E)}}),binfo._register("arrange",["core"],function(e,t){function v(){var e=u.chart;e.snapped||w(e),a.style("display","none"),f.style("display","none"),e.div.classed("arranging",!1),h.node().onselectstart=function(){return!0},u=null}function m(){var e=d3.mouse(c),t=e[0]+c.scrollLeft,n=e[1]+c.scrollTop;return[t,n]}function g(e,t){var n=u.chart,r=u.offsetX,i=u.offsetY,s,l,c=Math.abs,h=binfo.arrangeSnap;a.left=e-r,a.top=t-i,P(a),s=f.left-a.left,l=f.top-a.top,n.snapped&&(c(s)>h||c(l)>h)&&k(n),n.snapped||(n.left=a.left,n.top=a.top,P(n),b(n)),o=!0}function y(e){var t=Math.round(a.top/binfo.chartHeight),n,r,i=1e10,s=!1,o;return t<0&&(t=0),t>=d.length&&(t=d.length-1),E(t,e.levels,function(e){var t=Math.abs(e-a.left);t<i&&(i=t,r=e)}),o=Math.abs(a.top-t*binfo.chartHeight),n=.5*binfo.chartHeight,n*=1/(binfo.arrangeInsertFocalDiff*binfo.arrangeInsertFocalDiff),o<binfo.arrangeInsertMaxDiff&&o<n*i*i&&(s=!0,T(t,t+1,function(e){e.startLevel<t&&(s=!1)})),s&&(r=l.left,i=Math.abs(r-a.left)),_(f,r,t),e.div.classed("insert",s),f.classed("insert",s),{level:t,left:r,insert:s,diff:i,topDiff:o}}function b(e){var t=y(e);if(Math.abs(t.topDiff)>=binfo.arrangeSnap)return;if(t.diff>=binfo.arrangeSnap)return;w(e,t)}function w(e,t){t=t||y(e);var n=null,r=t.level,i=t.left;t.insert&&L(r,e.levels),E(r,e.levels,function(e,t){e>i&&n===null&&(n=t)},function(t){n===null&&(n=t.length),t.splice(n,0,e),n=null}),S(),D(e,!0,t.insert),_(e,i,r),O(e)}function E(e,t,n,r){var i,s,o,u;for(i=e;i<e+t;i++){s=d[i];for(o=0;o<s.length;o++)u=s[o].left+s[o].width,n(u,o);r&&r(s)}}function S(){var e=0;d.forEach(function(t,n){t.length>1&&(e=n)}),s=e,i=0,d[e].forEach(function(e){i=Math.max(i,e.startLevel)})}function x(e,t,n){var r;for(r=e;r<t;r++)n(d[r],r)}function T(e,t,n){x(e,t,function(e,t){var r;for(r=1;r<e.length;r++)n(e[r],r,t)})}function N(e,t){T(e.startLevel,e.startLevel+e.levels,function(n,r,i){n===e&&t(d[i],r,i)})}function C(e){var t=[];return N(e,function(e,n){var r=e[n+1];r&&t.indexOf(r)<0&&t.push(r)}),t}function k(e){var t=C(e),n=[];N(e,function(e,t,r){e.splice(t,1),e.length===1&&n.push(r)}),D(e,!1),A(t),n.forEach(function(e,t){L(e-t,-1)})}function L(e,t){var n,r,o={};t>0?(n=d.splice(d.length-t-1,t),d.splice.apply(d,[e,0].concat(n))):(r=d.splice(e,-t),d=d.concat(r)),i+=t,s+=t,T(e,s+1,function(e){if(o[e.id])return;_(e,e.left,e.startLevel+t),o[e.id]=!0})}function A(e){e.forEach(function(e){M(e)})}function O(e){A(C(e))}function M(e){var t=0;N(e,function(e,n){t=Math.max(t,e[n-1].left+e[n-1].width)}),t!==e.left&&(e.left=t,P(e),O(e))}function _(e,t,n){e.left=t,e.startLevel=n,e.top=n*binfo.chartHeight,P(e)}function D(e,t){e.snapped=t,e.div.classed("unsnapped",!t),f.classed("unsnapped",!t)}function P(e){e.div.style("left",e.left+"px").style("top",e.top+"px")}var n,r,i,s,o,u,a,f,l,c,h,p=1,d;e.setup=function(e,t,o){h=e,n=t,r=o,c=r.node(),a=r.append("div").attr("class","ghost").style("display","none"),a.div=a,f=r.append("div").attr("class","positioner arranging").style("display","none"),f.div=f,i=0,s=0,d=[],l={left:binfo.holderMargin,width:0,id:"dummy",levels:0,startLevel:0};var p;for(p=0;p<binfo.maxLevels;p++)d[p]=[l];h.on("mousemove.arrange",function(){var e=m();u&&g.apply(null,e)}),h.on("mouseup.arrange",function(){u&&v()})},e.start=function(e){var t=m();h.node().onselectstart=function(){return!1},p+=1,e.div.style("z-index",p),a.width=e.width,a.height=e.height-binfo.chartBorder/2,a.left=e.left,a.top=e.top,f.height=e.height+binfo.chartBorder,f.width=e.width+binfo.chartBorder,a.levels=e.levels,a.style("display","block").style("width",a.width+"px").style("height",a.height+"px"),P(a),f.style("display","block").style("width",f.width+"px").style("height",f.height+"px"),y(e),e.div.classed("arranging",!0),u={chart:e,offsetX:t[0]-e.left,offsetY:t[1]-e.top}},e.remove=function(e,t){e.forEach(function(e){k(t[e])}),S(),o=!0},e.add=function(e,t){var n=window.innerWidth-binfo.holderMargin-binfo.chartBorder;e.forEach(function(e){var r=t[e],s=r.levels,o=r.width,u,a,f,l,c=0,h,p,v,m=-1,g=i,y;while(g<d.length){u=d[g],l=u[u.length-1],a=l.left+l.width,f=n-a,f>=o||u.length===1?c?(p=Math.abs(f-h),p<=binfo.fitWidthMaxDiff?(c+=1,h=Math.min(f,h)):(h=f,c=1)):(h=f,c=1):c=0;if(c===s)break;g===0&&m===-1&&(m=1,g=i-s,g<0&&(g=-1),c=0),g+=m}v=m===1?g-s+1:g,x(v,v+s,function(e){e.push(r)}),i=Math.max(v,i),D(r,!0),_(r,n-h,v)}),S(),o=!0},e.orderedChartIds=function(){if(!o)return null;var e=t.chartIds(),i=t.charts(),s,u,a=[];s=e.map(function(e){return i[e]}),s.sort(function(e,t){return e.top===t.top?e.left-t.left:e.top-t.top});var f=s[s.length-1],l=f?f.top+f.height:0,c=l+820;return r.style("height",c+"px"),n.style("height",c+30+"px"),o=!1,u=s.map(function(e){return e.id}),t.reorder(u),u}}),binfo._register("charts",["core","logic","arrange"],function(e,t,n,r){"use strict";function i(e,t){typeof t=="number"&&(t+="px");var n=d3.select(".holder").append("span").style("font-size",t).text(e),r=n.property("offsetWidth");return n.remove(),Math.ceil(r)}function s(e){var t=e.dimensions||{},n=binfo.chartDimensions,r;for(r in n)n.hasOwnProperty(r)&&(t[r]||(t[r]=n[r]));return t}function o(e){var t={};return t.left=e.left,t.right=e.right,t.bottom=e.bottom,t.top=e.top,t}function u(e,n){n.div=e;var i=e.select(".title").text(n.label).style("display","none");e.append("div").attr("class","remove").html("&#10006;").on("click",function(){t.removeChart(n.id)}),e.on("mousedown",function(){var t=d3.event.target;if(t!==e.node()&&t!==i.node())return;r.start(n)})}function a(e,t,n){var r=t.actualHeight||t.height,i=t.left+t.right,s=t.top+t.bottom;n?(i+=r,s+=t.width):(i+=t.width,s+=r);var o=e.append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+t.left+","+t.top+")");return n&&o.attr("transform","matrix(0,1,-1,0,"+(t.actualHeight+t.left)+","+t.top+")"),o}function f(e,t){var n=e.property("offsetWidth")-binfo.chartBorder,r=n-binfo.chartPadding*2-binfo.chartBorder,i,s;t.width=n,e.style("width",r+"px"),e.select(".title").style("width",r-15+"px").style("display",null),i=e.property("offsetHeight")-binfo.chartBorder-5,s=Math.ceil(i/binfo.chartHeight),t.levels=s,t.height=s*binfo.chartHeight,i=t.height-(binfo.chartBorder+2*binfo.chartPadding),t.snapped=!1,e.style("height",i+"px")}function l(e,t,n){e.onbrush=function(r,i){var s=d3.select(this.parentNode),o=e.extent(),u=d3.event.mode==="move",a=u?n.round:n.floor,f=u?n.round:n.ceil;n.round&&(o&&Array.isArray(o[0])?o=[o[0].map(a),o[1].map(f)]:o=[a(o[0]),f(o[1])],s.select(".brush").call(p,e.extent(o))),e.empty()||t(o)},e.on("brush",e.onbrush),e.onbrushend=function(){e.empty()&&t(null)},e.on("brushend",e.onbrushend)}function c(e,t){t=t||30;var n=+(e==="e"),r=n?1:-1,i=Math.min(t,30),s=t/2-i/2;return"M"+.5*r+","+s+"A6,6 0 0 "+n+" "+6.5*r+","+(s+6)+"V"+(s+i-6)+"A6,6 0 0 "+n+" "+.5*r+","+(s+i)+"Z"+"M"+2.5*r+","+(s+i/4)+"V"+(s+i-i/4)+"M"+4.5*r+","+(s+i/4)+"V"+(s+i-i/4)}function h(e,t,n){var r=e.append("g").attr("class","brush");r.append("text").attr("class","remove").on("mousedown",function(){return t.clear(),t.onbrushend(),!1}).text("✖"),r.call(p,t),n&&r.selectAll("rect").attr("height",n);var i=n?c:function(){return"M0,0"};return r.selectAll(".resize").append("path").attr("d",function(e){return i(e,n)}),r}function p(e,t){var n=t.extent(),r,i;Array.isArray(n[0])?(r=[n[1][0],n[0][1]],r[1]=t.y()(r[1])):r=[n[1],0],r[0]=t.x()(r[0]),i=e.select(".remove").remove(),e.call(t),e.node().appendChild(i.node()),i.attr("x",r[0]-6).attr("y",r[1]+11).style("display",t.empty()?"none":null)}function m(e,n){function C(n){e.api.filter(n),t.refresh()}function k(t,n,r){var i=r.orientFlip,s=r.compare,o,u;typeof i=="undefined"&&(i=m),u=t.append("g"),s&&u.attr("transform","scale(1,"+g+")"),v+=1,u.append("clipPath").attr("id","clip-"+v).attr("class","clip-"+e.api.id).append("rect").attr("width",n.width).attr("height",n.height),u.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(e){return e+" bar"}),u.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+v+")"),o=t.append("g").attr("class","axis"),e.ordinal?(o.attr("transform","matrix(0,-1,1,0,0,"+n.actualHeight+")").classed("ordinal",!0),o.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n.width),o.selectAll("text").data(e.ordinal()).enter().append("text").attr("y",function(e,t){return(t+.9)*n.binWidth}).attr("x",-6).text(function(e){return e})):i?(S.orient("left"),o.attr("transform","matrix(0,-1,1,0,0,"+n.actualHeight+")").call(S)):(S.orient("bottom"),o.attr("transform","translate(0,"+n.actualHeight+")").call(S));var a=h(t,x,n.actualHeight);i&&a.selectAll(".resize").style("cursor","ns-resize")}function L(t,n){function s(){var t=d3.select(this);e.filterActive()?C(null):C(!0)}function o(){var e=[];i.selectAll(".range").each(function(){e.push(this.value)});var t=y(e[0]),r=y(e[1]);t<=r&&r>=0&&t<=n.width&&C(e),u(!1)}function u(e){e?r.classed("down",!1).text("Update").on("click",o):(r.on("click",s),A(t))}var r,i=t.append("div").attr("class","peripherals filter-bar");r=i.append("div").attr("class","filter button"),u(!1),i.selectAll(".range").data(["left","right"]).enter().append("input").attr("type","text").attr("class",function(e){return"range "+e}).property("value",function(t,n){return e.filterRange()[n]}).on("keydown",function(){d3.event.keyCode===13?o():u(!0)})}function A(t){var n=e.filterActive();t.select(".filter.button").text(n?"Reset":"Filter").classed("down",n)}function O(t,n,i){var s,o,u,a=i.compare;N&&(n.selectAll(".brush").call(p,x),a||(A(t),t.selectAll(".range").property("value",function(t,n){return e.filterRange()[n]})),e.filterActive()?(u=x.extent(),n.selectAll(".clip-"+e.api.id+" rect").attr("x",y(u[0])).attr("width",y(u[1])-y(u[0])),a||(s=n.selectAll(".percent").data([1]),s.enter().append("text").attr("class","percent").attr("y",-4),s.attr("x",(y(u[1])+y(u[0]))/2))):(n.selectAll(".clip-"+e.api.id+" rect").attr("x",0).attr("width",r.width),n.selectAll(".percent").data([]).exit().remove())),a||(o=e.percent(),s=n.selectAll(".percent").text(d(o))),n.selectAll(".bar").attr("d",T)}var r=s(n),c=o(r),m=!1,g=n.compareHeightScale||binfo.compareHeightScale,y=n.x,b=n.y||d3.scale.linear().range([r.height,0]),w=n.tickSpacing||binfo.tickSpacing,E=n.ticks,S=d3.svg.axis(),x=d3.svg.brush(),T,N;n.tickSpacing===!1&&(w=!1),r.compareHeight=r.height*g,e.ordinal&&(m=!0),e.api.label=n.label,e.api.defaultOrientFlip=m,e.api.dim=r,r.labelWidth=i(e.api.label,binfo.axisLabelSize),l(x,C,e),e.updateChart=function(){var t=e.rawGroups(),n=[],i=-1,s=t.length,o=r.height,u=r.binWidth-1,a;b.domain([0,e.maxY()]);while(++i<s)a=t[i],n.push("M",y(a.key),",",o,"V",b(a.value),"h",u,"V",o);T=n.join("")},e.api.render=function(){var t=d3.select(this),n,i,s,o=t.datum(),l=o.orientFlip,h=o.compare,p,d;typeof l=="undefined"&&(l=m),h?(n=t,p=n.select("path")):(i=t,n=i.select("g"),p=n);if(p.empty()){l?s={top:r.left,right:r.top,bottom:r.right,left:r.bottom}:s={};for(d in r)r.hasOwnProperty(d)&&typeof s[d]=="undefined"&&(s[d]=r[d]);l&&!e.ordinal&&(s.left=c.left+r.maxTickWidth),s.actualHeight=h?s.compareHeight:s.height,h||(u(i,e.api),n=a(i,s,l)),k(n,s,o),h||(L(i,s),f(i,e.api))}O(i,n,o)},e.addChart=function(){var t=e.minX(),s=e.maxX(),o;n.x||(n.type==="date"?y=d3.time.scale():y=d3.scale.linear(),y.domain([t,s]).rangeRound([0,e.api.numGroups()*r.binWidth])),e.x=y,e.ordinal||(S.scale(y),n.format&&S.tickFormat(n.format)),x.x(y),r.width=y.range()[1];if(E||w)o=e.ticks||Math.round(r.width/w),S.ticks(o);var u=0,a,f,l,h=0;e.ordinal?(e.ordinal().forEach(function(e){u=Math.max(u,i(e,binfo.axisTickSize))}),r.bottom=c.bottom+u,r.maxTickWidth=0):(a=S.tickFormat()||y.tickFormat(),o=S.tickValues()||y.ticks(o||binfo.numGroups),f=i(a(o[0])),l=i(a(o[o.length-1])),o.forEach(function(e){h=Math.max(h,i(a(e)))}),r.left=c.left+Math.ceil(f/2),r.right=c.right+Math.ceil(l/2),r.maxTickWidth=h)},e.chartFilter=function(){var t=e.filterActive()?e.filterRange():null;t?x.extent(t):x.clear(),N=!0},e.resetUpdateChart=function(){N=!1}}function g(e,n){function T(t){e.api.filter(t)}function N(t){var n=e.api.div.select("g.compare");w=t,t?A(n):O(n)}function C(n){e.api.given(n),t.refresh()}function k(e){var n;return e.append("g").attr("class","yc inner-chart").datum({compare:!0,orientFlip:!0}).attr("transform","matrix(0,1,-1,0,"+r.yHeight+","+r.yTop+")"),e.append("g").attr("class","xc inner-chart").attr("transform","translate("+r.xLeft+","+r.xTop+")").datum({compare:!0,orientFlip:!1}),n=e.append("g").attr("class","compare").attr("transform","translate("+r.xLeft+","+r.yTop+")").on("mousemove",function(){A(n)}).on("mouseout",function(){t.isMouseOut()&&O(n)}),n.selectAll(".compare.level").data(x).enter().append("path").attr("class",function(e){return"level-"+e+" compare level"}),n.append("text").attr("class","compare percent").attr("transform","translate("+r.xWidth/2+",-5)"),n.append("rect").attr("class","hover").style("display","none"),h(n,m),e.append("g").attr("transform","translate("+(-r.left+7)+","+r.yWidth/2+") rotate(90)").append("text").attr("class","axis-label").text(v.label),e.append("text").attr("x",r.xLeft+r.xWidth/2).attr("y",r.height+r.bottom-8).attr("class","axis-label").text(c.label),e}function L(t){var n=d3.mouse(t.node()),i=n[0]-1,s=n[1]-1;return i<0||s<0?null:(i=Math.floor(i/r.binWidth),s=Math.floor(s/r.binWidth),i>=e.xcNumGroups()||s>=e.ycNumGroups()?null:{xi:i,yi:s})}function A(e){w&&M(e,L(e))}function O(e){M(e,null)}function M(t,n){var i=t.select("rect.hover"),s=r.binWidth,o,u;i.style("display",n?null:"none");if(!n){P();return}o=n.xi,u=n.yi,i.attr("x",o*s).attr("y",u*s).attr("width",s).attr("height",s),P(e.stats([[o,u],[o+1,u+1]]))}function _(t){function y(t){e.api.filterLevels(t)}var n,i,s,o,u,a,f,c,d,v,m=d3.svg.brush(),g;o=16,u=2,f=30,i=16,s=10,a=b*u,d=d3.scale.linear().domain([0,100]).range([a-1,0]),c=d3.svg.axis().scale(d).orient("right"),m.x(d),v={round:e.round,ceil:e.round,floor:e.round},l(m,y,v),n=t.append("svg").attr("class","legend").attr("height",a+2*i).attr("width",o+f+s).append("g").attr("transform","translate("+s+","+i+")"),n.append("text").attr("class","axis-label").attr("x",o/2).attr("y",-6).text("Level"),n.append("g").attr("transform","translate("+o+",0)").attr("class","axis").call(c),n.selectAll("rect.level").data(x).enter().append("rect").attr("class",function(e){return"level level-"+e}).attr("x",0).attr("y",function(e,t){return a-(t+1)*u}).attr("width",o).attr("height",u);var w=h(n,m,o).attr("transform","rotate(90) translate(0,"+ -o+")");w.selectAll(".resize").style("cursor","ns-resize"),w.select("text.remove").attr("transform","translate(12,-1)"),e.updateLegend=function(t){t?m.extent(t):(m.clear(),t=[0,100]),w.call(p,m),e.api.div.selectAll(".level").each(function(e){d3.select(this).classed("level-fade-"+e,e<t[0]||e>=t[1])})},e.updateLegend(S),g=t.append("div").attr("class","peripherals given-bar").style("width",r.width+"px").style("margin-left",r.left+r.xLeft+"px"),g.append("div").attr("class","words").text("Given"),g.append("div").attr("class","xc given button"),g.append("div").attr("class","words").text("or"),g.append("div").attr("class","yc given button"),g.selectAll(".given.button").data(["xc","yc"]).text(function(t){return e[t].label}).classed("down",function(t){return e.api.given()===t}).on("click",function(t){var n=d3.select(this);e.api.given()===t?C(null):C(t)})}function D(t,n){n.selectAll(".yc.inner-chart").each(v.render),n.selectAll(".xc.inner-chart").each(c.render),n.selectAll(".compare.level").attr("d",function(e){return y[e]}),t.selectAll(".given.button").classed("down",function(t){return e.api.given()===t}),P()}function P(t){var n=e.api.div.select("g.compare"),t=t||e.filterStats(),r="";t&&(r=d(t.percent)+" (Lvl: "+t.level+")"),n.select("text.percent").text(r)}var r=s(n),i=o(r),c=e.xc,v=e.yc,m=d3.svg.brush(),g,y=[],b=binfo.compareLevels,w=!0,E,S,x=[];e.api.label=c.label+" vs. "+v.label;for(E=0;E<b;E++)x.push(E);l(m,T,e),m.on("brushstart.compare",function(){N(!1)}),m.on("brushend.compare",function(){N(!0)}),e.updateChart=function(){var t=e.levelsMatrix(),n=t.length,i=t[0].length,s=[],o,u,a,f=r.binWidth,l,c;for(o=1;o<b;o++)s[o]=[];s[-1]=s[0]={push:function(){},join:function(){return g}};for(o=0;o<n;o++){l=o*f;for(u=0;u<i;u++)c=u*f,a=t[o][u],s[a].push("M",l,",",c,"v",f,"h",f,"v",-f)}for(o=0;o<b;o++)y[o]=s[o].join("")||"M0,0"},e.api.render=function(t){var t=d3.select(this),n=t.select("g");n.empty()&&(u(t,e.api),n=a(t,r,!1),t.select("svg").attr("class","compare"),k(n),_(t),f(t,e.api)),D(t,n)},e.chartLevels=function(t){S=t,e.updateLegend&&e.updateLegend(t)},e.addChart=function(){var t;r.left=v.dim.bottom+v.dim.maxTickWidth+14,r.bottom=c.dim.bottom+14+(c.ordinal?0:10),r.xHeight=c.dim.compareHeight,r.yHeight=v.dim.compareHeight,r.xWidth=c.dim.width,r.yWidth=v.dim.width,t=Math.ceil((c.dim.labelWidth-c.dim.width)/2),r.right=Math.max(r.right,t),r.left=Math.max(r.left,t-r.yHeight),t=Math.ceil((v.dim.labelWidth-v.dim.width)/2),r.top=Math.max(r.top,t),r.bottom=Math.max(r.bottom,t-r.xHeight),r.xTop=r.yWidth+4,r.xLeft=r.yHeight+2,r.yTop=2,r.width=r.yHeight+r.xWidth+4,r.height=r.yWidth+r.xHeight+4,r.actualHeight=r.height,g="M-1,-1V"+(r.xTop-r.yTop-2)+"H"+(r.width-r.xLeft-2)+"V-1H-1";var n=d3.scale.linear().domain([0,e.xcNumGroups()]).rangeRound([0,e.xcNumGroups()*r.binWidth]),i=d3.scale.linear().domain([0,e.ycNumGroups()]).rangeRound([0,e.ycNumGroups()*r.binWidth]);m.x(n).y(i)},e.api.cleanUp=function(){},e.chartFilter=function(t){t?m.extent(t):m.clear(),e.api.div&&(e.api.div.selectAll("g.compare .brush").call(p,m),P())}}e.barChart=function(e,t){var r={api:{}};return n.barLogic(r,e,t),m(r,e),r.api},e.compareChart=function(e){var t={api:{}};return n.compareLogic(t,e),g(t,e),t.api};var d=d3.format(".3p"),v=0}),binfo._register("logic",["hash"],function(e,t){"use strict";function n(e){return function(t){return Math.floor(t/e+1e-7)*e}}function r(e){return function(t){return Math.ceil(t/e-1e-7)*e}}function i(e){return function(t){return Math.round(t/e)*e}}function s(e,t){e.round=i(t),e.floor=n(t),e.ceil=r(t)}e.barLogic=function(e,t,r){function L(t){var n=1e9,r={},i,s=[];if(e.ordinal){t.forEach(function(e){e=p(e);var t=r[e];if(typeof t!="undefined")return;t=E(e);if(t>=0){r[e]=t;return}r[e]=n,n++});for(i in r)r.hasOwnProperty(i)&&s.push({value:i,order:r[i]});s.sort(function(e,t){return e.order-t.order}),s.forEach(function(e,t){w[e.value]=t,b[t]=x(e.value)})}}var i=0,o=0,u,a,f,l,c,h,p,d,v,m,g,y,b=[],w={},E,S={},x,T=t.minX,N=t.maxX,C=t.maxY,k=t.separation;e.api.id=t.id,e.round=t.round,e.floor=t.floor||t.round,e.ceil=t.ceil||t.ceil,e.round&&typeof e.round=="number"&&s(e,e.round),h=t.dimension||function(t){return t[e.api.id]},t.ordinal&&(k=1,s(e,1),Array.isArray(t.ordinal)?t.ordinal.forEach(function(e,t){S[e]=t}):S=t.ordinal,typeof S=="object"?E=function(e){var t=S[e];return!t&&t!==0?-1:t}:typeof t.ordinal=="function"?E=t.ordinal:E=function(){return-1},p=h,h=function(e){return w[p(e)]},x=t.format||function(e){return e});if(t.group)g=t.group;else if(t.groupBy)k=k||t.groupBy,g=n(k);else if(t.groupIdentity||t.ordinal)g=function(e){return e};t.ordinal&&(e.ordinal=function(){return b},e.api.ordinal=!0),e.api.dimensionFunc=function(){return h},e.api.groupFunc=function(){return g},e.api.groups=function(){return v},e.rawGroups=function(){return m},e.minX=function(){return T},e.maxX=function(){return N},e.maxY=function(){return C},e.filterActive=function(){return f},e.filterRange=function(){return a},e.percent=function(){return l.value()/y.value()},e.api.numGroups=function(){return v.length},e.api.groupIndex=function(e){return Math.round((e-T)/k)},L(r),e.api.filter=function(t){return arguments.length?(t?(f=!0,t===!0?t=a:a=t,c&&(+t[0]===+t[1]?c.filterExact(t[0]):c.filterRange(t))):(f=!1,c&&c.filterAll()),e.chartFilter(),e):f?a:null},e.api.addCross=function(r,i){o+=1;if(o>1)return;l=i,c=r.dimension(h);if(!g){var s=c.top(Infinity),u=+h(s[0]),a=+h(s[s.length-1]),p=Math.abs(u-a),b=d3.scale.linear().domain([0,p]),w=b.ticks(t.numGroups||binfo.numGroups);k=w[1]-w[0],g=n(k)}d=c.group(g),m=d.all(),y=c.groupAll(),t.minX||(T=+m[0].key),t.maxX||(N=+m[m.length-1].key+k);var E={value:0},S,x=0,C,L;v=[];for(S=0;S<m.length;S++){C=e.api.groupIndex(m[S].key);for(;x<C;x++)v.push(E);v.push(m[S]),x+=1}L=Math.round((N-T)/k);for(;x<L;x++)v.push(E);e.api.filter(f)},e.api.add=function(){i+=1,e.chartFilter();if(i>1)return;e.addChart();if(!a){var t=e.x.ticks(20),n=t[Math.round(t.length*.3)],r=t[Math.round(t.length*.7)];e.round&&(n=e.round(n),r=e.round(r)),a=[n,r]}},e.api.removeCross=function(){o-=1},e.api.remove=function(){i-=1,i||e.api.filter(null)},e.api.update=function(){if(u)return;u=!0,t.maxY||(C=d.top(1)[0].value),e.updateChart()},e.api.resetUpdate=function(){if(!u)return;u=!1,e.resetUpdateChart()},e.api.addToParams=function(t){t.filter[e.api.id]=e.api.filter()}},e.compareLogic=function(e,n){function L(t){e.api[t]=function(){i[t](),o[t]()}}var r=n.id.split("-"),i=n.charts[r[0]],o=n.charts[r[1]],u=null,a,f,l,c,h,p,d,v,m,g,y,b=binfo.compareLevels,w=Math.pow(2,20),E,S,x,T,N,C,k;e.api.id=n.id,e.xc=i,e.yc=o,e.levelsMatrix=function(){return y},e.xcNumGroups=function(){return d},e.ycNumGroups=function(){return v},e.filterStats=function(){return x},s(e,1),e.api.given=function(e){if(!arguments.length)return u;u=e},e.api.filter=function(n){if(!arguments.length)return S;n&&n.length===4?S=[[+n[0],+n[1]],[+n[2],+n[3]]]:S=n,x=e.stats(S),t.refreshParams(),e.chartFilter(S)},e.api.filterLevels=function(n){if(!arguments.length)return T;T=n,t.refreshParams(),e.chartLevels(n)},E=function(e){var t=i.groupIndex(h(l(e))),n=o.groupIndex(p(c(e)));return t+n*w},e.api.addToParams=function(t){t.filterLevels[e.api.id]=T,t.given[e.api.id]=u;var n=S;t.filter[e.api.id]=n?[n[0][0],n[0][1],n[1][0],n[1][1]]:null,t.filter[i.id]=i.filter(),t.filter[o.id]=o.filter()},e.api.addCross=function(e,t){a=t,i.addCross(e,a),o.addCross(e,a),l=i.dimensionFunc(),c=o.dimensionFunc(),h=i.groupFunc(),p=o.groupFunc(),m=i.groups(),g=o.groups(),d=i.numGroups(),v=o.numGroups();var n=e.dimension(E);N=n.group(),C=N.all();var r;k=[],y=[];for(r=0;r<d;r++)k[r]=[],y[r]=[]},e.api.add=function(){i.add(),o.add(),e.addChart()},e.api.remove=function(){i.remove(),o.remove(),e.api.given(null),e.api.filterLevels(null),e.api.filter(null)},["removeCross","resetUpdate"].forEach(function(e){L(e)}),e.api.update=function(){i.update(),o.update();var t,n,r,s=C.length,a,f=b-1e-9,l=f/3,c,h,p,E;for(t=0;t<d;t++)for(n=0;n<v;n++)k[t][n]=0,y[t][n]=0;r=-1;while(++r<s)a=C[r],t=a.key%w,n=Math.round(a.key/w),k[t][n]=a.value;if(!u){E=f/(N.top(1)[0].value+1e-300);for(t=0;t<d;t++)for(n=0;n<v;n++)y[t][n]=Math.floor(k[t][n]*E)}else if(u==="yc")for(n=0;n<v;n++){E=d/(g[n].value+1e-300);for(t=0;t<d;t++)c=k[t][n]*E,h=Math.log(1+c)*l,p=Math.min(b-1,Math.floor(h)),y[t][n]=p}else for(t=0;t<d;t++){E=v/(m[t].value+1e-300);for(n=0;n<v;n++)c=k[t][n]*E,h=Math.log(1+c)*l,p=Math.min(b-1,Math.floor(h)),y[t][n]=p}x=e.stats(S),e.updateChart()},e.stats=function(e){if(!e)return null;var t=e[0][0],n=e[0][1],r=e[1][0],i=e[1][1],s,o,f,l,c,h,p,b,w,E,S;c=0,b=0,f=r-t,l=i-n,w=f*l;for(s=t;s<r;s++)for(o=n;o<i;o++)c+=k[s][o],b+=y[s][o];S=Math.round(b/w);if(!u)E=c/a.value();else if(u==="yc"){c=0;for(o=n;o<i;o++){h=g[o].value;if(h){p=0;for(s=t;s<r;s++)p+=k[s][o]/h}else p=f/d;c+=p}E=c/l}else{c=0;for(s=t;s<r;s++){h=m[s].value,p=0;if(h)for(o=n;o<i;o++)p+=k[s][o]/h;else p=l/v;c+=p}E=c/f}return{level:S,percent:E}}}}),binfo._register("setup",["core"],function(setup,core){"use strict";function checkLoaded(e){definitions[e]&&data[e]&&core.dataSet(e,definitions[e],data[e])}var definitions={},data={},untypedData={};binfo.definitionsFromJSON=function(dataName,defns){function makeEvil(e,t){return function(n){if(!e[n])return;evil.push('defns["',t,'"].',n," = ",e[n],";")}}function maybeMakeEvil(e,t){var n=makeEvil(e,t);return function(t){typeof e[t]=="string"&&e[t].slice(0,8)==="function"&&n(t)}}var id,defn,evil=[],evalParts=["dimension","group","round","x","y","format"],evalPartsIfFunc=["type","ordinal"];for(id in defns)defns.hasOwnProperty(id)&&(defn=defns[id],evalParts.forEach(makeEvil(defn,id)),evalPartsIfFunc.forEach(maybeMakeEvil(defn,id)));eval(evil.join("")),binfo.definitions(dataName,defns)},binfo.definitions=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(t[n].id=n,t[n].type=t[n].type||"number");definitions[e]=t,untypedData[e]?binfo.dataFromUntyped(e,untypedData[e]):checkLoaded(e)},binfo.dataFromUntyped=function(e,t){if(!definitions[e]){untypedData[e]=t;return}var n=definitions[e],r,i;t.forEach(function(e){for(r in n){if(!n.hasOwnProperty(r))continue;i=n[r];if(i.derived)continue;if(typeof i.type=="function"){e[r]=i.type(e[r]);return}switch(i.type){case"number":e[r]=+e[r];break;case"date":e[r]=new Date(e[r]);break;default:}}}),binfo.data(e,t)},binfo.data=function(e,t){data[e]=t,checkLoaded(e)}}),binfo._register("stylesheet",[],function(e){e.setup=function(e){function N(e,o,u){for(n=0;n<i;n++)r=s(n),t+="."+e+"-"+n+"{fill:hsl(",t+=b(r)+",",t+=o(r)+"%,",t+=u(S(r))+"%",t+=");}"}var t="",n,r,i=binfo.compareLevels,s=d3.scale.linear(),o=[],u,a=222,f=200,l=180,c=158,h=120,p=80,d=60,v=45,m=30,g=15,y=0,b=d3.scale.linear(),w=d3.scale.linear(),E=d3.scale.linear(),S=d3.scale.linear(),x=d3.scale.linear(),T=d3.scale.identity();s.domain([0,i-1]).range([0,1]),o=[{d:0,h:a,b:35},{d:.17,h:f,b:40},{d:.22,h:l,b:35},{d:.3,h:c,b:38},{d:.41,h:h,b:42},{d:.54,h:p,b:60},{d:.65,h:d,b:50},{d:.725,h:v,b:50},{d:.83,h:m,b:50},{d:.95,h:g,b:50},{d:1,h:y,b:60}],u=o.map(function(e){return e.d}),b.range(o.map(function(e){return e.h})),S.range(o.map(function(e){return e.b})),w.domain([0,1]).range([100,100]),E.domain([0,1]).range([40,40]),b.domain(u),S.domain(u),x.domain([35,60]).range([78,92]),N("level",w,T),N("level-fade",E,x),e.append("style").html(t)}}),binfo._register("hashRetrieval",["core"],function(e,t){"use strict";function n(){var e={},t,n=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s=window.location.hash.substring(1);t=r.exec(s);while(t)e[i(t[1])]=i(t[2]),t=r.exec(s);return e}function r(){var e=n(),r=e.data,s=e.charts&&e.charts.split(","),o={};o.given=i(e.given),o.filter=i(e.filter),o.filterLevels=i(e.filterLevels);if(!r||!s||!s.length)return;t.renderFresh(r,s,o)}function i(e){var t=e&&e.split(","),n={};return t&&t.forEach(function(e){var t=e.split("*"),r=t.slice(1);r.length===1&&(r=r[0]),n[t[0]]=r}),n}window.onhashchange=r,r()}),binfo._register("hash",["arrange"],function(e,t){function f(e,t){function o(e){return typeof e=="object"&&(e=e.valueOf()),encodeURIComponent(e)}var n=e[t],r,i,s=[];for(i in n)n.hasOwnProperty(i)&&n[i]&&(r=n[i],Array.isArray(r)&&(r=r.map(o).join("*")),s.push(i+"*"+r));return t+"="+s.join(",")}function l(){u=!1;var e=t.orderedChartIds(n,r);e?(a=!0,n=e):e=n;if(a){s[1]="charts="+e.join(",");var i="#"+s.join("&");window.history.replaceState({},"",i),u=!0,a=!1}}var n,r,i,s=[0,0,0],o=!0,u=!1,a=!1;e.disable=function(){o=!1},e.refresh=function(t,s,u){i=t,n=s,r=u,o=!0,e.refreshParams()},e.refreshParams=function(){if(!o)return;var e={filter:{},given:{},filterLevels:{}};n.forEach(function(t){r[t].addToParams(e)}),s=["data="+i,null,f(e,"given"),f(e,"filterLevels"),f(e,"filter")],a=!0,u||l()},setInterval(l,600)}),binfo._register("rendering",["core"],function(e,t){"use strict";function s(e){return function(t){d3.select(this).each(t.chart[e])}}var n,r=d3.format(",d"),i=d3.format(".3p"),o=s("update"),u=s("render"),a=s("resetUpdate");e.refresh=function(e,t){n.each(o),n.each(u),n.each(a),d3.select(".active-data").text(r(e)),d3.select(".total").text(r(t)),d3.select(".percent-active").text(" ("+i(e/t)+")")},e.render=function(e,t){var r;r=e.map(function(e,n){return{chart:t[e]}}),n=d3.select(".holder").selectAll(".chart").data(r,function(e){return e.chart.id}),n.enter().append("div").attr("class","chart").append("div").attr("class","title"),n.exit().remove(),n.order()}}),binfo._register("ui",["core"],function(e,t){"use strict";function h(){var e=s.select(".options-panel"),t=e.style("display");e.style("display",t==="block"?"none":"block"),s.select(".options.button").classed("down",t==="none")}function p(e){e=e?null:"none",f||s.select(".statistics").style("display",e),s.select(".statistics ul").style("display",e)}function d(e){if(e===u)return;var n=t.dataSet(e),r=n.definitionIds,i=n.definitions,o,f;u=e,a>1&&s.select(".data-name select").property("value",u),o=r.map(function(e){return{id:e,label:i[e].label}}),f=s.select(".statistics ul").selectAll("li").data(o,function(e){return e.id}),f.enter().append("li").on("click",v).text(function(e){return e.label}),f.exit().remove()}function v(e){l==="compare"?c?(c!==e.id&&t.addChart(c+"-"+e.id),m()):(c=e.id,d3.select(this).classed("down",!0)):t.addChart(e.id)}function m(){c=null,s.selectAll(".statistics li.down").classed("down",!1)}function g(e){l===e&&(e=null),o&&clearTimeout(o),l=e,s.select(".compare.button").classed("down",e==="compare"),s.select(".bar.button").classed("down",e==="bar"),e?p(!0):(p(!1),m())}var n=e.dependency("rendering"),r=e.dependency("setup"),i,s,o,u,a=0,f,l,c;e.setup=function(e){function p(){var e=this.id.slice(7),n=e==="always";t.updateMode(e),f.style("display"
,n?"none":"block"),n&&t.update()}function d(e,t){var n=c.append("div");n.append("input").attr("type","radio").attr("name","update").attr("id",e).on("click",p),n.append("label").attr("for",e).text(t)}i=e,i.attr("class","holder");var n,r,u,a,f,l,c;s=i.append("div").attr("class","control-panel"),s.append("div").attr("class","tool title").text("Binfo"),n=s.append("div").attr("class","config"),r=n.append("div").attr("class","totals pane"),r.append("span").attr("class","active-data").text("-"),r.append("span").attr("class","percent-active").text(" (XX.X%)"),r.append("span").text(" of "),r.append("span").attr("class","total").text("-"),r.append("span").attr("class","data-name"),u=n.append("div").attr("class","interactions pane").on("mouseover",function(){o&&clearTimeout(o)}).on("mouseout",function(){t.isMouseOut()&&(o=setTimeout(g,550))}),u.append("span").text("Add"),u.append("div").attr("class","bar button").text("Bar").on("click",function(){g("bar")}),u.append("span").text("or"),u.append("div").attr("class","compare button").text("Comparison").on("click",function(){g("compare")}),u.append("span").text("charts."),a=u.append("div").attr("class","statistics").style("display","none"),a.append("ul"),f=a.append("div").attr("class","update panel").style("display","none"),f.append("div").attr("class","update action button").text("Update").on("click",function(){t.update("force")}),f.append("div").attr("class","cancel button").text("Cancel").style("display","none").on("click",t.cancel),n.append("div").attr("class","remove-all button").text("Remove All").on("click",t.clearCharts),l=s.append("div").attr("class","view-toggles pane"),l.append("div").text("Options").attr("class","options button").on("click",h),c=l.append("div").attr("class","options-panel").style("display","none"),c.append("div").attr("class","title").text("Options"),c.append("div").attr("class","remove").html("&#10006;").on("click",h),d("update-always","Always update automatically"),d("update-smart","Smart update (on mouse still)"),d("update-manual","Manual update"),c.select("#update-"+t.updateMode()).property("checked",!0),c.append("div").attr("class","close-options button").text("Close").on("click",h)},e.addDataName=function(n){a+=1;if(a===1)s.select(".data-name").text(n+".");else if(a===2){var r=s.select(".data-name"),i=r.text();i=i.slice(0,i.length-1),r.html(""),r.append("select").on("change",function(){d(this.value),t.changeDataName(this.value)}),e.addDataName(i),a-=1,d(i)}a>1&&s.select(".data-name select").append("option").attr("value",n).text(n)},e.needsUpdate=function(e){f=e,e&&s.select(".statistics").style("display","block"),s.select(".update.action.button").classed("active",e),s.select(".cancel.button").style("display",e?null:"none")},e.updating=function(e){i.style("opacity",e?.3:null),s.classed("updating",e)},e.updated=function(t){d(t),e.needsUpdate(!1),e.updating(!1)}});