(function(){"use strict";function define(e,t){function s(e){var t=/(\.?\.\/?)*/.exec(e)[0],i=Math.floor(t.replace(/\//g,"").length/1.9+.99),o;i&&(o=n.slice(0,n.length-i).join("/"),o&&(o+="/"),e=o+e.slice(t.length)),e=e.replace(/\/$/,"");var u=r.get(e);if(!u)throw s.id=e,s;return u}window.vaccine||function(){var e={},t={};window.vaccine={on:function(t,n){(e[t]=e[t]||[]).push(n)},get:function(e){return t[e]},set:function(n,r){t[n]=r,(e[n]||[]).forEach(function(e){e()})}}}();var n=e.split("/"),r=window.vaccine,i={exports:{}};try{t(s,i.exports,i),r.set(e,i.exports)}catch(o){if(o!=s)throw o;r.on(s.id,function(){define(e,t)})}}define("datazooka/arrange",function(e,t){function g(){var e=f.chart;e.snapped||S(e),l.style("display","none"),c.style("display","none"),e.div.classed("arranging",!1),d.node().onselectstart=function(){return!0},f=null}function y(){var e=n.mouse(p),t=e[0]+p.scrollLeft,r=e[1]+p.scrollTop;return[t,r]}function b(e,t){var n=f.chart,i=f.offsetX,s=f.offsetY,o,u,h=Math.abs,p=r.arrangeSnap;l.left=e-i,l.top=t-s,B(l),o=c.left-l.left,u=c.top-l.top,n.snapped&&(h(o)>p||h(u)>p)&&A(n),n.snapped||(n.left=l.left,n.top=l.top,B(n),E(n)),a=!0}function w(e){var t=Math.round(l.top/r.chartHeight),n,i,s=1e10,o=!1,u;return t<0&&(t=0),t>=m.length&&(t=m.length-1),x(t,e.levels,function(e){var t=Math.abs(e-l.left);t<s&&(s=t,i=e)}),u=Math.abs(l.top-t*r.chartHeight),n=.5*r.chartHeight,n*=1/(r.arrangeInsertFocalDiff*r.arrangeInsertFocalDiff),u<r.arrangeInsertMaxDiff&&u<n*s*s&&(o=!0,C(t,t+1,function(e){e.startLevel<t&&(o=!1)})),o&&(i=h.left,s=Math.abs(i-l.left)),P(c,i,t),e.div.classed("insert",o),c.classed("insert",o),{level:t,left:i,insert:o,diff:s,topDiff:u}}function E(e){var t=w(e);if(Math.abs(t.topDiff)>=r.arrangeSnap)return;if(t.diff>=r.arrangeSnap)return;S(e,t)}function S(e,t){t=t||w(e);var n=null,r=t.level,i=t.left;t.insert&&O(r,e.levels),x(r,e.levels,function(e,t){e>i&&n===null&&(n=t)},function(t){n===null&&(n=t.length),t.splice(n,0,e),n=null}),T(),H(e,!0,t.insert),P(e,i,r),_(e)}function x(e,t,n,r){var i,s,o,u;for(i=e;i<e+t;i++){s=m[i];for(o=0;o<s.length;o++)u=s[o].left+s[o].width,n(u,o);r&&r(s)}}function T(){var e=0;m.forEach(function(t,n){t.length>1&&(e=n)}),u=e,o=0,m[e].forEach(function(e){o=Math.max(o,e.startLevel)})}function N(e,t,n){var r;for(r=e;r<t;r++)n(m[r],r)}function C(e,t,n){N(e,t,function(e,t){var r;for(r=1;r<e.length;r++)n(e[r],r,t)})}function k(e,t){C(e.startLevel,e.startLevel+e.levels,function(n,r,i){n===e&&t(m[i],r,i)})}function L(e){var t=[];return k(e,function(e,n){var r=e[n+1];r&&t.indexOf(r)<0&&t.push(r)}),t}function A(e){var t=L(e),n=[];k(e,function(e,t,r){e.splice(t,1),e.length===1&&n.push(r)}),H(e,!1),M(t),n.forEach(function(e,t){O(e-t,-1)})}function O(e,t){var n,r,i={};t>0?(n=m.splice(m.length-t-1,t),m.splice.apply(m,[e,0].concat(n))):(r=m.splice(e,-t),m=m.concat(r)),o+=t,u+=t,C(e,u+1,function(e){if(i[e.id])return;P(e,e.left,e.startLevel+t),i[e.id]=!0})}function M(e){e.forEach(function(e){D(e)})}function _(e){M(L(e))}function D(e){var t=0;k(e,function(e,n){t=Math.max(t,e[n-1].left+e[n-1].width)}),t!==e.left&&(e.left=t,B(e),_(e))}function P(e,t,n){e.left=t,e.startLevel=n,e.top=n*r.chartHeight,B(e)}function H(e,t){e.snapped=t,e.div.classed("unsnapped",!t),c.classed("unsnapped",!t)}function B(e){e.div.style("left",e.left+"px").style("top",e.top+"px")}var n=e("d3"),r=e("./config"),i,s,o,u,a,f,l,c,h,p,d,v=1,m;t.setup=function(e,t,n){d=e,i=t,s=n,p=s.node(),l=s.append("div").attr("class","ghost").style("display","none"),l.div=l,c=s.append("div").attr("class","positioner arranging").style("display","none"),c.div=c,o=0,u=0,m=[],h={left:r.holderMargin,width:0,id:"dummy",levels:0,startLevel:0};var a;for(a=0;a<r.maxLevels;a++)m[a]=[h];d.on("mousemove.arrange",function(){var e=y();f&&b.apply(null,e)}),d.on("mouseup.arrange",function(){f&&g()})},t.start=function(e){var t=y();d.node().onselectstart=function(){return!1},v+=1,e.div.style("z-index",v),l.width=e.width,l.height=e.height-r.chartBorder/2,l.left=e.left,l.top=e.top,c.height=e.height+r.chartBorder,c.width=e.width+r.chartBorder,l.levels=e.levels,l.style("display","block").style("width",l.width+"px").style("height",l.height+"px"),B(l),c.style("display","block").style("width",c.width+"px").style("height",c.height+"px"),w(e),e.div.classed("arranging",!0),f={chart:e,offsetX:t[0]-e.left,offsetY:t[1]-e.top}},t.remove=function(e,t){e.forEach(function(e){A(t[e])}),T(),a=!0},t.add=function(e,t){var n=window.innerWidth-r.holderMargin-r.chartBorder;e.forEach(function(e){var i=t[e],s=i.levels,u=i.width,a,f,l,c,h=0,p,d,v,g=-1,y=o,b;while(y<m.length){a=m[y],c=a[a.length-1],f=c.left+c.width,l=n-f,l>=u||a.length===1?h?(d=Math.abs(l-p),d<=r.fitWidthMaxDiff?(h+=1,p=Math.min(l,p)):(p=l,h=1)):(p=l,h=1):h=0;if(h===s)break;y===0&&g===-1&&(g=1,y=o-s,y<0&&(y=-1),h=0),y+=g}v=g===1?y-s+1:y,N(v,v+s,function(e){e.push(i)}),o=Math.max(v,o),H(i,!0),P(i,n-p,v)}),T(),a=!0},t.orderedChartIds=function(){if(!a)return null;var t=e("./core"),n=t.chartIds(),r=t.charts(),o,u,f=[];o=n.map(function(e){return r[e]}),o.sort(function(e,t){return e.top===t.top?e.left-t.left:e.top-t.top});var l=o[o.length-1],c=l?l.top+l.height:0,h=c+820;return s.style("height",h+"px"),i.style("height",h+30+"px"),a=!1,u=o.map(function(e){return e.id}),t.reorder(u),u}}),define("datazooka/charts",function(e,t){function u(e,t){typeof t=="number"&&(t+="px");var r=n.select(".holder").append("span").style("font-size",t).text(e),i=r.property("offsetWidth");return r.remove(),Math.ceil(i)}function a(e){var t=e.dimensions||{},n=s.chartDimensions,r;for(r in n)n.hasOwnProperty(r)&&(t[r]||(t[r]=n[r]));return t}function f(e){var t={};return t.left=e.left,t.right=e.right,t.bottom=e.bottom,t.top=e.top,t}function l(e,t){t.div=e;var r=e.select(".title").text(t.label).style("display","none");e.append("div").attr("class","remove").html("&#10006;").on("click",function(){o.removeChart(t.id)}),e.on("mousedown",function(){var s=n.event.target;if(s!==e.node()&&s!==r.node())return;i.start(t)})}function c(e,t,n){var r=t.actualHeight||t.height,i=t.left+t.right,s=t.top+t.bottom;n?(i+=r,s+=t.width):(i+=t.width,s+=r);var o=e.append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+t.left+","+t.top+")");return n&&o.attr("transform","matrix(0,1,-1,0,"+(t.actualHeight+t.left)+","+t.top+")"),o}function h(e,t){var n=e.property("offsetWidth")-s.chartBorder,r=n-s.chartPadding*2-s.chartBorder,i,o;t.width=n,e.style("width",r+"px"),e.select(".title").style("width",r-15+"px").style("display",null),i=e.property("offsetHeight")-s.chartBorder-5,o=Math.ceil(i/s.chartHeight),t.levels=o,t.height=o*s.chartHeight,i=t.height-(s.chartBorder+2*s.chartPadding),t.snapped=!1,e.style("height",i+"px")}function p(e,t,r){e.onbrush=function(i,s){var o=n.select(this.parentNode),u=e.extent(),a=n.event.mode==="move",f=a?r.round:r.floor,l=a?r.round:r.ceil;r.round&&(u&&Array.isArray(u[0])?u=[u[0].map(f),u[1].map(l)]:u=[f(u[0]),l(u[1])],o.select(".brush").call(m,e.extent(u))),e.empty()||t(u)},e.on("brush",e.onbrush),e.onbrushend=function(){e.empty()&&t(null)},e.on("brushend",e.onbrushend)}function d(e,t){t=t||30;var n=+(e==="e"),r=n?1:-1,i=Math.min(t,30),s=t/2-i/2;return"M"+.5*r+","+s+"A6,6 0 0 "+n+" "+6.5*r+","+(s+6)+"V"+(s+i-6)+"A6,6 0 0 "+n+" "+.5*r+","+(s+i)+"Z"+"M"+2.5*r+","+(s+i/4)+"V"+(s+i-i/4)+"M"+4.5*r+","+(s+i/4)+"V"+(s+i-i/4)}function v(e,t,n){var r=e.append("g").attr("class","brush");r.append("text").attr("class","remove").on("mousedown",function(){return t.clear(),t.onbrushend(),!1}).text("âœ–"),r.call(m,t),n&&r.selectAll("rect").attr("height",n);var i=n?d:function(){return"M0,0"};return r.selectAll(".resize").append("path").attr("d",function(e){return i(e,n)}),r}function m(e,t){var n=t.extent(),r,i;Array.isArray(n[0])?(r=[n[1][0],n[0][1]],r[1]=t.y()(r[1])):r=[n[1],0],r[0]=t.x()(r[0]),i=e.select(".remove").remove(),e.call(t),e.node().appendChild(i.node()),i.attr("x",r[0]-6).attr("y",r[1]+11).style("display",t.empty()?"none":null)}function b(e,t){function L(t){e.api.filter(t),o.refresh()}function A(t,n,r){var i=r.orientFlip,s=r.compare,o,u;typeof i=="undefined"&&(i=d),u=t.append("g"),s&&u.attr("transform","scale(1,"+b+")"),y+=1,u.append("clipPath").attr("id","clip-"+y).attr("class","clip-"+e.api.id).append("rect").attr("width",n.width).attr("height",n.height),u.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(e){return e+" bar"}),u.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+y+")"),o=t.append("g").attr("class","axis"),e.ordinal?(o.attr("transform","matrix(0,-1,1,0,0,"+n.actualHeight+")").classed("ordinal",!0),o.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n.width),o.selectAll("text").data(e.ordinal()).enter().append("text").attr("y",function(e,t){return(t+.9)*n.binWidth}).attr("x",-6).text(function(e){return e})):i?(T.orient("left"),o.attr("transform","matrix(0,-1,1,0,0,"+n.actualHeight+")").call(T)):(T.orient("bottom"),o.attr("transform","translate(0,"+n.actualHeight+")").call(T));var a=v(t,N,n.actualHeight);i&&a.selectAll(".resize").style("cursor","ns-resize")}function O(t,r){function o(){var t=n.select(this);e.filterActive()?L(null):L(!0)}function u(){var e=[];s.selectAll(".range").each(function(){e.push(this.value)});var t=w(e[0]),n=w(e[1]);t<=n&&n>=0&&t<=r.width&&L(e),a(!1)}function a(e){e?i.classed("down",!1).text("Update").on("click",u):(i.on("click",o),M(t))}var i,s=t.append("div").attr("class","peripherals filter-bar");i=s.append("div").attr("class","filter button"),a(!1),s.selectAll(".range").data(["left","right"]).enter().append("input").attr("type","text").attr("class",function(e){return"range "+e}).property("value",function(t,n){return e.filterRange()[n]}).on("keydown",function(){n.event.keyCode===13?u():a(!0)})}function M(t){var n=e.filterActive();t.select(".filter.button").text(n?"Reset":"Filter").classed("down",n)}function _(t,n,i){var s,o,u,a=i.compare;k&&(n.selectAll(".brush").call(m,N),a||(M(t),t.selectAll(".range").property("value",function(t,n){return e.filterRange()[n]})),e.filterActive()?(u=N.extent(),n.selectAll(".clip-"+e.api.id+" rect").attr("x",w(u[0])).attr("width",w(u[1])-w(u[0])),a||(s=n.selectAll(".percent").data([1]),s.enter().append("text").attr("class","percent").attr("y",-4),s.attr("x",(w(u[1])+w(u[0]))/2))):(n.selectAll(".clip-"+e.api.id+" rect").attr("x",0).attr("width",r.width),n.selectAll(".percent").data([]).exit().remove())),a||(o=e.percent(),s=n.selectAll(".percent").text(g(o))),n.selectAll(".bar").attr("d",C)}var r=a(t),i=f(r),d=!1,b=t.compareHeightScale||s.compareHeightScale,w=t.x,E=t.y||n.scale.linear().range([r.height,0]),S=t.tickSpacing||s.tickSpacing,x=t.ticks,T=n.svg.axis(),N=n.svg.brush(),C,k;t.tickSpacing===!1&&(S=!1),r.compareHeight=r.height*b,e.ordinal&&(d=!0),e.api.label=t.label,e.api.defaultOrientFlip=d,e.api.dim=r,r.labelWidth=u(e.api.label,s.axisLabelSize),p(N,L,e),e.updateChart=function(){var t=e.rawGroups(),n=[],i=-1,s=t.length,o=r.height,u=r.binWidth-1,a;E.domain([0,e.maxY()]);while(++i<s)a=t[i],n.push("M",w(a.key),",",o,"V",E(a.value),"h",u,"V",o);C=n.join("")},e.api.render=function(){var t=n.select(this),s,o,u,a=t.datum(),f=a.orientFlip,p=a.compare,v,m;typeof f=="undefined"&&(f=d),p?(s=t,v=s.select("path")):(o=t,s=o.select("g"),v=s);if(v.empty()){f?u={top:r.left,right:r.top,bottom:r.right,left:r.bottom}:u={};for(m in r)r.hasOwnProperty(m)&&typeof u[m]=="undefined"&&(u[m]=r[m]);f&&!e.ordinal&&(u.left=i.left+r.maxTickWidth),u.actualHeight=p?u.compareHeight:u.height,p||(l(o,e.api),s=c(o,u,f)),A(s,u,a),p||(O(o,u),h(o,e.api))}_(o,s,a)},e.addChart=function(){var o=e.minX(),a=e.maxX(),f;t.x||(t.type==="date"?w=n.time.scale():w=n.scale.linear(),w.domain([o,a]).rangeRound([0,e.api.numGroups()*r.binWidth])),e.x=w,e.ordinal||(T.scale(w),t.format&&T.tickFormat(t.format)),N.x(w),r.width=w.range()[1];if(x||S)f=e.ticks||Math.round(r.width/S),T.ticks(f);var l=0,c,h,p,d=0;e.ordinal?(e.ordinal().forEach(function(e){l=Math.max(l,u(e,s.axisTickSize))}),r.bottom=i.bottom+l,r.maxTickWidth=0):(c=T.tickFormat()||w.tickFormat(),f=T.tickValues()||w.ticks(f||s.numGroups),h=u(c(f[0])),p=u(c(f[f.length-1])),f.forEach(function(e){d=Math.max(d,u(c(e)))}),r.left=i.left+Math.ceil(h/2),r.right=i.right+Math.ceil(p/2),r.maxTickWidth=d)},e.chartFilter=function(){var t=e.filterActive()?e.filterRange():null;t?N.extent(t):N.clear(),k=!0},e.resetUpdateChart=function(){k=!1}}function w(e,t){function C(t){e.api.filter(t)}function k(t){var n=e.api.div.select("g.compare");S=t,t?M(n):_(n)}function L(t){e.api.given(t),o.refresh()}function A(e){var t;return e.append("g").attr("class","yc inner-chart").datum({compare:!0,orientFlip:!0}).attr("transform","matrix(0,1,-1,0,"+r.yHeight+","+r.yTop+")"),e.append("g").attr("class","xc inner-chart").attr("transform","translate("+r.xLeft+","+r.xTop+")").datum({compare:!0,orientFlip:!1}),t=e.append("g").attr("class","compare").attr("transform","translate("+r.xLeft+","+r.yTop+")").on("mousemove",function(){M(t)}).on("mouseout",function(){o.isMouseOut()&&_(t)}),t.selectAll(".compare.level").data(N).enter().append("path").attr("class",function(e){return"level-"+e+" compare level"}),t.append("text").attr("class","compare percent").attr("transform","translate("+r.xWidth/2+",-5)"),t.append("rect").attr("class","hover").style("display","none"),v(t,y),e.append("g").attr("transform","translate("+(-r.left+7)+","+r.yWidth/2+") rotate(90)").append("text").attr("class","axis-label").text(d.label),e.append("text").attr("x",r.xLeft+r.xWidth/2).attr("y",r.height+r.bottom-8).attr("class","axis-label").text(u.label),e}function O(t){var i=n.mouse(t.node()),s=i[0]-1,o=i[1]-1;return s<0||o<0?null:(s=Math.floor(s/r.binWidth),o=Math.floor(o/r.binWidth),s>=e.xcNumGroups()||o>=e.ycNumGroups()?null:{xi:s,yi:o})}function M(e){S&&D(e,O(e))}function _(e){D(e,null)}function D(t,n){var i=t.select("rect.hover"),s=r.binWidth,o,u;i.style("display",n?null:"none");if(!n){B();return}o=n.xi,u=n.yi,i.attr("x",o*s).attr("y",u*s).attr("width",s).attr("height",s),B(e.stats([[o,u],[o+1,u+1]]))}function P(t){function b(t){e.api.filterLevels(t)}var i,s,o,u,a,f,l,c,h,d,g=n.svg.brush(),y;u=16,a=2,l=30,s=16,o=10,f=E*a,h=n.scale.linear().domain([0,100]).range([f-1,0]),c=n.svg.axis().scale(h).orient("right"),g.x(h),d={round:e.round,ceil:e.round,floor:e.round},p(g,b,d),i=t.append("svg").attr("class","legend").attr("height",f+2*s).attr("width",u+l+o).append("g").attr("transform","translate("+o+","+s+")"),i.append("text").attr("class","axis-label").attr("x",u/2).attr("y",-6).text("Level"),i.append("g").attr("transform","translate("+u+",0)").attr("class","axis").call(c),i.selectAll("rect.level").data(N).enter().append("rect").attr("class",function(e){return"level level-"+e}).attr("x",0).attr("y",function(e,t){return f-(t+1)*a}).attr("width",u).attr("height",a);var w=v(i,g,u).attr("transform","rotate(90) translate(0,"+ -u+")");w.selectAll(".resize").style("cursor","ns-resize"),w.select("text.remove").attr("transform","translate(12,-1)"),e.updateLegend=function(t){t?g.extent(t):(g.clear(),t=[0,100]),w.call(m,g),e.api.div.selectAll(".level").each(function(e){n.select(this).classed("level-fade-"+e,e<t[0]||e>=t[1])})},e.updateLegend(T),y=t.append("div").attr("class","peripherals given-bar").style("width",r.width+"px").style("margin-left",r.left+r.xLeft+"px"),y.append("div").attr("class","words").text("Given"),y.append("div").attr("class","xc given button"),y.append("div").attr("class","words").text("or"),y.append("div").attr("class","yc given button"),y.selectAll(".given.button").data(["xc","yc"]).text(function(t){return e[t].label}).classed("down",function(t){return e.api.given()===t}).on("click",function(t){var r=n.select(this);e.api.given()===t?L(null):L(t)})}function H(t,n){n.selectAll(".yc.inner-chart").each(d.render),n.selectAll(".xc.inner-chart").each(u.render),n.selectAll(".compare.level").attr("d",function(e){return w[e]}),t.selectAll(".given.button").classed("down",function(t){return e.api.given()===t}),B()}function B(t){var n=e.api.div.select("g.compare"),t=t||e.filterStats(),r="";t&&(r=g(t.percent)+" (Lvl: "+t.level+")"),n.select("text.percent").text(r)}var r=a(t),i=f(r),u=e.xc,d=e.yc,y=n.svg.brush(),b,w=[],E=s.compareLevels,S=!0,x,T,N=[];e.api.label=u.label+" vs. "+d.label;for(x=0;x<E;x++)N.push(x);p(y,C,e),y.on("brushstart.compare",function(){k(!1)}),y.on("brushend.compare",function(){k(!0)}),e.updateChart=function(){var t=e.levelsMatrix(),n=t.length,i=t[0].length,s=[],o,u,a,f=r.binWidth,l,c;for(o=1;o<E;o++)s[o]=[];s[-1]=s[0]={push:function(){},join:function(){return b}};for(o=0;o<n;o++){l=o*f;for(u=0;u<i;u++)c=u*f,a=t[o][u],s[a].push("M",l,",",c,"v",f,"h",f,"v",-f)}for(o=0;o<E;o++)w[o]=s[o].join("")||"M0,0"},e.api.render=function(t){var t=n.select(this),i=t.select("g");i.empty()&&(l(t,e.api),i=c(t,r,!1),t.select("svg").attr("class","compare"),A(i),P(t),h(t,e.api)),H(t,i)},e.chartLevels=function(t){T=t,e.updateLegend&&e.updateLegend(t)},e.addChart=function(){var t;r.left=d.dim.bottom+d.dim.maxTickWidth+14,r.bottom=u.dim.bottom+14+(u.ordinal?0:10),r.xHeight=u.dim.compareHeight,r.yHeight=d.dim.compareHeight,r.xWidth=u.dim.width,r.yWidth=d.dim.width,t=Math.ceil((u.dim.labelWidth-u.dim.width)/2),r.right=Math.max(r.right,t),r.left=Math.max(r.left,t-r.yHeight),t=Math.ceil((d.dim.labelWidth-d.dim.width)/2),r.top=Math.max(r.top,t),r.bottom=Math.max(r.bottom,t-r.xHeight),r.xTop=r.yWidth+4,r.xLeft=r.yHeight+2,r.yTop=2,r.width=r.yHeight+r.xWidth+4,r.height=r.yWidth+r.xHeight+4,r.actualHeight=r.height,b="M-1,-1V"+(r.xTop-r.yTop-2)+"H"+(r.width-r.xLeft-2)+"V-1H-1";var i=n.scale.linear().domain([0,e.xcNumGroups()]).rangeRound([0,e.xcNumGroups()*r.binWidth]),s=n.scale.linear().domain([0,e.ycNumGroups()]).rangeRound([0,e.ycNumGroups()*r.binWidth]);y.x(i).y(s)},e.api.cleanUp=function(){},e.chartFilter=function(t){t?y.extent(t):y.clear(),e.api.div&&(e.api.div.selectAll("g.compare .brush").call(m,y),B())}}var n=e("d3"),r=e("./logic"),i=e("./arrange"),s=e("./config"),o;window.vaccine.on("datazooka/core",function(){o=e("./core")}),t.barChart=function(e,t){var n={api:{}};return r.barLogic(n,e,t),b(n,e),n.api},t.compareChart=function(e){var t={api:{}};return r.compareLogic(t,e),w(t,e),t.api};var g=n.format(".3p"),y=0}),define("datazooka/config",function(e,t,n){n.exports={numGroups:35,tickSpacing:46,compareHeightScale:.2,chartHeight:200,chartPadding:5,chartBorder:5,maxLevels:50,arrangeSnap:40,arrangeInsertFocalDiff:550,arrangeInsertMaxDiff:50,holderMargin:15,compareLevels:100,axisTickSize:12,axisLabelSize:14,fitWidthMaxDiff:220,chartDimensions:{top:16,right:10,bottom:20,left:10,height:100,width:100,binWidth:11}}}),define("datazooka/core",function(e,t){function L(e,t){return e.filter(function(e){return t.indexOf(e)<0})}function A(){d!==null&&(clearTimeout(d),d=null)}function O(){d=setTimeout(function(){t.update("always")},700)}function M(){_(m,"filter"),_(m,"given"),_(m,"filterLevels"),m=null,g=!1}function _(e,t){var n,r=e[t];for(n in r)r.hasOwnProperty(n)&&k[n][t](r[n])}function D(){b=!1,y=!1,i.updated(S)}var n=e("crossfilter"),r=e("d3"),i=e("./ui"),s=e("./rendering"),o=e("./charts"),u=e("./hash"),a=e("./arrange"),f=e("./stylesheet"),l={},c,h,p="always",d=null,v,m,g,y=!0,b,w,E,S,x=[],T,N,C,k;t.isMouseOut=function(){var e=r.event,t=e.currentTarget,n;n=e.relatedTarget;if(n){while(n!==t&&n.nodeName!=="BODY"&&n.parentNode)n=n.parentNode;if(n===t)return!1}return!0},t.dataSet=function(e,n,r){var s,u;if(!n)return s=l[e],s?s:null;l[e]=s={definitions:n,data:r},s.definitionIds=[],s.charts={};for(u in n)n.hasOwnProperty(u)&&(s.charts[u]=o.barChart(n[u],r),s.definitionIds.push(u));s.chartIds=s.definitionIds.slice(),i.addDataName(e),v&&v[0]===e&&t.renderFresh.apply(null,v)},t.setup=function(e){var t=r.select(e.holder).attr("class","outer-holder"),n=t.append("div"),s=r.select(e.root);i.setup(n),a.setup(s,t,n),f.setup(n),s.on("mousemove.exports",function(){d!==null&&(A(),O())})},t.dataName=function(e){if(!arguments.length)return S;if(e===S)return;y=!0,N=e,k=l[N].charts,C=[]},t.addChart=function(e){if(C.indexOf(e)>=0)return;t.chartIds(C.concat([e])),t.update()},t.removeChart=function(e){var n=C.slice();n.splice(n.indexOf(e),1),t.chartIds(n),t.update()},t.changeDataName=function(e){t.dataName(e),t.update()},t.clearCharts=function(){t.chartIds([]),t.update()},t.cancel=function(){N=S,k=T,C=x,D()},t.reorder=function(e){x=e},t.charts=function(){return T},t.chartIds=function(e){if(!arguments.length)return x;C=e,C.forEach(function(e){k[e]||(k[e]=o.compareChart({id:e,charts:k}))}),E=L(x,C),w=L(C,x);if(w.length||E.length)y=!0},t.defaultRender=function(e,n,r){v||t.renderFresh(e,n,r)},t.renderFresh=function(e,n,r){if(!l[e]){v=[e,n,r];return}t.dataName(e),t.chartIds(n),g=!0,m=r||{filters:{},given:{},filterLevels:{}},t.update("force")},t.updateMode=function(e){if(!arguments.length)return p;p=e},t.update=function(e){e||(e=p);if(!y&&e!=="force")return;if(e==="manual"){i.needsUpdate(!0);return}A();if(!c||N!==S||E.length||w.length){if(e==="smart"){i.needsUpdate(!0),O();return}if(!b){b=!0,i.updating(!0),setTimeout(function(){t.update(e)},30);return}}u.disable();var r=l[N].data,o=w,f=E;if(!c||N!==S||E.length)c=n(r),h=c.groupAll(),o=C,f=x,E.length||(w=o,E=f);g&&(w=C,E=x),f.forEach(function(e){T[e].removeCross()}),o.forEach(function(e){k[e].addCross(c,h)}),E.forEach(function(e){T[e].remove()}),w.forEach(function(e){k[e].add()}),s.render(C,k),g&&M(),s.refresh(h.value(),c.size()),a.remove(E,T),a.add(w,k),S=N,T=k,x=C,u.refresh(S,x,T),D()},t.refresh=function(){s.refresh(h.value(),c.size()),u.refresh(S,x,T)}}),define("datazooka/hash",function(e,t){function l(e,t){function o(e){return typeof e=="object"&&(e=e.valueOf()),encodeURIComponent(e)}var n=e[t],r,i,s=[];for(i in n)n.hasOwnProperty(i)&&n[i]&&(r=n[i],Array.isArray(r)&&(r=r.map(o).join("*")),s.push(i+"*"+r));return t+"="+s.join(",")}function c(){a=!1;var e=n.orderedChartIds(r,i);e?(f=!0,r=e):e=r;if(f){o[1]="charts="+e.join(",");var t="#"+o.join("&");window.history.replaceState({},"",t),a=!0,f=!1}}var n=e("./arrange"),r,i,s,o=[0,0,0],u=!0,a=!1,f=!1;t.disable=function(){u=!1},t.refresh=function(e,n,o){s=e,r=n,i=o,u=!0,t.refreshParams()},t.refreshParams=function(){if(!u)return;var e={filter:{},given:{},filterLevels:{}};r.forEach(function(t){i[t].addToParams(e)}),o=["data="+s,null,l(e,"given"),l(e,"filterLevels"),l(e,"filter")],f=!0,a||c()},setInterval(c,600)}),define("datazooka/hash_retrieval",function(e){function n(){var e={},t,n=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s=window.location.hash.substring(1);t=r.exec(s);while(t)e[i(t[1])]=i(t[2]),t=r.exec(s);return e}function r(){var e=n(),r=e.data,s=e.charts&&e.charts.split(","),o={};o.given=i(e.given),o.filter=i(e.filter),o.filterLevels=i(e.filterLevels);if(!r||!s||!s.length)return;t.renderFresh(r,s,o)}function i(e){var t=e&&e.split(","),n={};return t&&t.forEach(function(e){var t=e.split("*"),r=t.slice(1);r.length===1&&(r=r[0]),n[t[0]]=r}),n}var t=e("./core");window.onhashchange=r,r()}),define("datazooka",function(e,t,n){n.exports=e("datazooka/index")}),define("datazooka/index",function(require,exports){function checkLoaded(e){definitions[e]&&data[e]&&core.dataSet(e,definitions[e],data[e])}require("./hash_retrieval");var core=require("./core"),definitions={},data={},untypedData={};exports.setup=core.setup,exports.defaultRender=core.defaultRender,exports.definitionsFromJSON=function(dataName,defns){function makeEvil(e,t){return function(n){if(!e[n])return;evil.push('defns["',t,'"].',n," = ",e[n],";")}}function maybeMakeEvil(e,t){var n=makeEvil(e,t);return function(t){typeof e[t]=="string"&&e[t].slice(0,8)==="function"&&n(t)}}var id,defn,evil=[],evalParts=["dimension","group","round","x","y","format"],evalPartsIfFunc=["type","ordinal"];for(id in defns)defns.hasOwnProperty(id)&&(defn=defns[id],evalParts.forEach(makeEvil(defn,id)),evalPartsIfFunc.forEach(maybeMakeEvil(defn,id)));eval(evil.join("")),exports.definitions(dataName,defns)},exports.definitions=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(t[n].id=n,t[n].type=t[n].type||"number");definitions[e]=t,untypedData[e]?exports.dataFromUntyped(e,untypedData[e]):checkLoaded(e)},exports.dataFromUntyped=function(e,t){if(!definitions[e]){untypedData[e]=t;return}var n=definitions[e],r,i;t.forEach(function(e){for(r in n){if(!n.hasOwnProperty(r))continue;i=n[r];if(i.derived)continue;if(typeof i.type=="function"){e[r]=i.type(e[r]);return}switch(i.type){case"number":e[r]=+e[r];break;case"date":e[r]=new Date(e[r]);break;default:}}}),exports.data(e,t)},exports.data=function(e,t){data[e]=t,checkLoaded(e)},window.datazooka=exports}),define("datazooka/logic",function(e,t){function s(e){return function(t){return Math.floor(t/e+1e-7)*e}}function o(e){return function(t){return Math.ceil(t/e-1e-7)*e}}function u(e){return function(t){return Math.round(t/e)*e}}function a(e,t){e.round=u(t),e.floor=s(t),e.ceil=o(t)}var n=e("d3"),r=e("./hash"),i=e("./config");t.barLogic=function(e,t,r){function O(t){var n=1e9,r={},i,s=[];if(e.ordinal){t.forEach(function(e){e=v(e);var t=r[e];if(typeof t!="undefined")return;t=x(e);if(t>=0){r[e]=t;return}r[e]=n,n++});for(i in r)r.hasOwnProperty(i)&&s.push({value:i,order:r[i]});s.sort(function(e,t){return e.order-t.order}),s.forEach(function(e,t){S[e.value]=t,E[t]=N(e.value)})}}var o=0,u=0,f,l,c,h,p,d,v,m,g,y,b,w,E=[],S={},x,T={},N,C=t.minX,k=t.maxX,L=t.maxY,A=t.separation;e.api.id=t.id,e.round=t.round,e.floor=t.floor||t.round,e.ceil=t.ceil||t.ceil,e.round&&typeof e.round=="number"&&a(e,e.round),d=t.dimension||function(t){return t[e.api.id]},t.ordinal&&(A=1,a(e,1),Array.isArray(t.ordinal)?t.ordinal.forEach(function(e,t){T[e]=t}):T=t.ordinal,typeof T=="object"?x=function(e){var t=T[e];return!t&&t!==0?-1:t}:typeof t.ordinal=="function"?x=t.ordinal:x=function(){return-1},v=d,d=function(e){return S[v(e)]},N=t.format||function(e){return e});if(t.group)b=t.group;else if(t.groupBy)A=A||t.groupBy,b=s(A);else if(t.groupIdentity||t.ordinal)b=function(e){return e};t.ordinal&&(e.ordinal=function(){return E},e.api.ordinal=!0),e.api.dimensionFunc=function(){return d},e.api.groupFunc=function(){return b},e.api.groups=function(){return g},e.rawGroups=function(){return y},e.minX=function(){return C},e.maxX=function(){return k},e.maxY=function(){return L},e.filterActive=function(){return c},e.filterRange=function(){return l},e.percent=function(){return h.value()/w.value()},e.api.numGroups=function(){return g.length},e.api.groupIndex=function(e){return Math.round((e-C)/A)},O(r),e.api.filter=function(t){return arguments.length?(t?(c=!0,t===!0?t=l:l=t,p&&(+t[0]===+t[1]?p.filterExact(t[0]):p.filterRange(t))):(c=!1,p&&p.filterAll()),e.chartFilter(),e):c?l:null},e.api.addCross=function(r,o){u+=1;if(u>1)return;h=o,p=r.dimension(d);if(!b){var a=p.top(Infinity),f=+d(a[0]),l=+d(a[a.length-1]),v=Math.abs(f-l),E=n.scale.linear().domain([0,v]),S=E.ticks(t.numGroups||i.numGroups);A=S[1]-S[0],b=s(A)}m=p.group(b),y=m.all(),w=p.groupAll(),t.minX||(C=+y[0].key),t.maxX||(k=+y[y.length-1].key+A);var x={value:0},T,N=0,L,O;g=[];for(T=0;T<y.length;T++){L=e.api.groupIndex(y[T].key);for(;N<L;N++)g.push(x);g.push(y[T]),N+=1}O=Math.round((k-C)/A);for(;N<O;N++)g.push(x);e.api.filter(c)},e.api.add=function(){o+=1,e.chartFilter();if(o>1)return;e.addChart();if(!l){var t=e.x.ticks(20),n=t[Math.round(t.length*.3)],r=t[Math.round(t.length*.7)];e.round&&(n=e.round(n),r=e.round(r)),l=[n,r]}},e.api.removeCross=function(){u-=1},e.api.remove=function(){o-=1,o||e.api.filter(null)},e.api.update=function(){if(f)return;f=!0,t.maxY||(L=m.top(1)[0].value),e.updateChart()},e.api.resetUpdate=function(){if(!f)return;f=!1,e.resetUpdateChart()},e.api.addToParams=function(t){t.filter[e.api.id]=e.api.filter()}},t.compareLogic=function(e,t){function A(t){e.api[t]=function(){s[t](),o[t]()}}var n=t.id.split("-"),s=t.charts[n[0]],o=t.charts[n[1]],u=null,f,l,c,h,p,d,v,m,g,y,b,w=i.compareLevels,E=Math.pow(2,20),S,x,T,N,C,k,L;e.api.id=t.id,e.xc=s,e.yc=o,e.levelsMatrix=function(){return b},e.xcNumGroups=function(){return v},e.ycNumGroups=function(){return m},e.filterStats=function(){return T},a(e,1),e.api.given=function(e){if(!arguments.length)return u;u=e},e.api.filter=function(t){if(!arguments.length)return x;t&&t.length===4?x=[[+t[0],+t[1]],[+t[2],+t[3]]]:x=t,T=e.stats(x),r.refreshParams(),e.chartFilter(x)},e.api.filterLevels=function(t){if(!arguments.length)return N;N=t,r.refreshParams(),e.chartLevels(t)},S=function(e){var t=s.groupIndex(p(c(e))),n=o.groupIndex(d(h(e)));return t+n*E},e.api.addToParams=function(t){t.filterLevels[e.api.id]=N,t.given[e.api.id]=u;var n=x;t.filter[e.api.id]=n?[n[0][0],n[0][1],n[1][0],n[1][1]]:null,t.filter[s.id]=s.filter(),t.filter[o.id]=o.filter()},e.api.addCross=function(e,t){f=t,s.addCross(e,f),o.addCross(e,f),c=s.dimensionFunc(),h=o.dimensionFunc(),p=s.groupFunc(),d=o.groupFunc(),g=s.groups(),y=o.groups(),v=s.numGroups(),m=o.numGroups();var n=e.dimension(S);C=n.group(),k=C.all();var r;L=[],b=[];for(r=0;r<v;r++)L[r]=[],b[r]=[]},e.api.add=function(){s.add(),o.add(),e.addChart()},e.api.remove=function(){s.remove(),o.remove(),e.api.given(null),e.api.filterLevels(null),e.api.filter(null)},["removeCross","resetUpdate"].forEach(function(e){A(e)}),e.api.update=function(){s.update(),o.update();var t,n,r,i=k.length,a,f=w-1e-9,l=f/3,c,h,p,d;for(t=0;t<v;t++)for(n=0;n<m;n++)L[t][n]=0,b[t][n]=0;r=-1;while(++r<i)a=k[r],t=a.key%E,n=Math.round(a.key/E),L[t][n]=a.value;if(!u){d=f/(C.top(1)[0].value+1e-300);for(t=0;t<v;t++)for(n=0;n<m;n++)b[t][n]=Math.floor(L[t][n]*d)}else if(u==="yc")for(n=0;n<m;n++){d=v/(y[n].value+1e-300);for(t=0;t<v;t++)c=L[t][n]*d,h=Math.log(1+c)*l,p=Math.min(w-1,Math.floor(h)),b[t][n]=p}else for(t=0;t<v;t++){d=m/(g[t].value+1e-300);for(n=0;n<m;n++)c=L[t][n]*d,h=Math.log(1+c)*l,p=Math.min(w-1,Math.floor(h)),b[t][n]=p}T=e.stats(x),e.updateChart()},e.stats=function(e){if(!e)return null;var t=e[0][0],n=e[0][1],r=e[1][0],i=e[1][1],s,o,a,l,c,h,p,d,w,E,S;c=0,d=0,a=r-t,l=i-n,w=a*l;for(s=t;s<r;s++)for(o=n;o<i;o++)c+=L[s][o],d+=b[s][o];S=Math.round(d/w);if(!u)E=c/f.value();else if(u==="yc"){c=0;for(o=n;o<i;o++){h=y[o].value;if(h){p=0;for(s=t;s<r;s++)p+=L[s][o]/h}else p=a/v;c+=p}E=c/l}else{c=0;for(s=t;s<r;s++){h=g[s].value,p=0;if(h)for(o=n;o<i;o++)p+=L[s][o]/h;else p=l/m;c+=p}E=c/a}return{level:S,percent:E}}}}),define("datazooka/rendering",function(e,t){function o(e){return function(t){n.select(this).each(t.chart[e])}}var n=e("d3"),r,i=n.format(",d"),s=n.format(".3p"),u=o("update"),a=o("render"),f=o("resetUpdate");t.refresh=function(e,t){r.each(u),r.each(a),r.each(f),n.select(".active-data").text(i(e)),n.select(".total").text(i(t)),n.select(".percent-active").text(" ("+s(e/t)+")")},t.render=function(e,t){var i;i=e.map(function(e,n){return{chart:t[e]}}),r=n.select(".holder").selectAll(".chart").data(i,function(e){return e.chart.id}),r.enter().append("div").attr("class","chart").append("div").attr("class","title"),r.exit().remove(),r.order()}}),define("datazooka/stylesheet",function(e,t){var n=e("d3"),r=e("./config");t.setup=function(e){function k(e,n,r){for(i=0;i<o;i++)s=u(i),t+="."+e+"-"+i+"{fill:hsl(",t+=E(s)+",",t+=n(s)+"%,",t+=r(T(s))+"%",t+=");}"}var t="",i,s,o=r.compareLevels,u=n.scale.linear(),a=[],f,l=222,c=200,h=180,p=158,d=120,v=80,m=60,g=45,y=30,b=15,w=0,E=n.scale.linear(),S=n.scale.linear(),x=n.scale.linear(),T=n.scale.linear(),N=n.scale.linear(),C=n.scale.identity();u.domain([0,o-1]).range([0,1]),a=[{d:0,h:l,b:35},{d:.17,h:c,b:40},{d:.22,h:h,b:35},{d:.3,h:p,b:38},{d:.41,h:d,b:42},{d:.54,h:v,b:60},{d:.65,h:m,b:50},{d:.725,h:g,b:50},{d:.83,h:y,b:50},{d:.95,h:b,b:50},{d:1,h:w,b:60}],f=a.map(function(e){return e.d}),E.range(a.map(function(e){return e.h})),T.range(a.map(function(e){return e.b})),S.domain([0,1]).range([100,100]),x.domain([0,1]).range([40,40]),E.domain(f),T.domain(f),N.domain([35,60]).range([78,92]),k("level",S,C),k("level-fade",x,N),e.append("style").html(t)}}),define("datazooka/ui",function(e,t){function h(){var e=s.select(".options-panel"),t=e.style("display");e.style("display",t==="block"?"none":"block"),s.select(".options.button").classed("down",t==="none")}function p(e){e=e?null:"none",f||s.select(".statistics").style("display",e),s.select(".statistics ul").style("display",e)}function d(e){if(e===u)return;var t=r.dataSet(e),n=t.definitionIds,i=t.definitions,o,f;u=e,a>1&&s.select(".data-name select").property("value",u),o=n.map(function(e){return{id:e,label:i[e].label}}),f=s.select(".statistics ul").selectAll("li").data(o,function(e){return e.id}),f.enter().append("li").on("click",v).text(function(e){return e.label}),f.exit().remove()}function v(e){l==="compare"?c?(c!==e.id&&r.addChart(c+"-"+e.id),m()):(c=e.id,n.select(this).classed("down",!0)):r.addChart(e.id)}function m(){c=null,s.selectAll(".statistics li.down").classed("down",!1)}function g(e){l===
e&&(e=null),o&&clearTimeout(o),l=e,s.select(".compare.button").classed("down",e==="compare"),s.select(".bar.button").classed("down",e==="bar"),e?p(!0):(p(!1),m())}var n=e("d3"),r,i,s,o,u,a=0,f,l,c;window.vaccine.on("datazooka/core",function(){r=e("./core")}),t.setup=function(e){function p(){var e=this.id.slice(7),t=e==="always";r.updateMode(e),f.style("display",t?"none":"block"),t&&r.update()}function d(e,t){var n=c.append("div");n.append("input").attr("type","radio").attr("name","update").attr("id",e).on("click",p),n.append("label").attr("for",e).text(t)}i=e,i.attr("class","holder");var t,n,u,a,f,l,c;s=i.append("div").attr("class","control-panel"),s.append("div").attr("class","tool title").text("Binfo"),t=s.append("div").attr("class","config"),n=t.append("div").attr("class","totals pane"),n.append("span").attr("class","active-data").text("-"),n.append("span").attr("class","percent-active").text(" (XX.X%)"),n.append("span").text(" of "),n.append("span").attr("class","total").text("-"),n.append("span").attr("class","data-name"),u=t.append("div").attr("class","interactions pane").on("mouseover",function(){o&&clearTimeout(o)}).on("mouseout",function(){r.isMouseOut()&&(o=setTimeout(g,550))}),u.append("span").text("Add"),u.append("div").attr("class","bar button").text("Bar").on("click",function(){g("bar")}),u.append("span").text("or"),u.append("div").attr("class","compare button").text("Comparison").on("click",function(){g("compare")}),u.append("span").text("charts."),a=u.append("div").attr("class","statistics").style("display","none"),a.append("ul"),f=a.append("div").attr("class","update panel").style("display","none"),f.append("div").attr("class","update action button").text("Update").on("click",function(){r.update("force")}),f.append("div").attr("class","cancel button").text("Cancel").style("display","none").on("click",r.cancel),t.append("div").attr("class","remove-all button").text("Remove All").on("click",r.clearCharts),l=s.append("div").attr("class","view-toggles pane"),l.append("div").text("Options").attr("class","options button").on("click",h),c=l.append("div").attr("class","options-panel").style("display","none"),c.append("div").attr("class","title").text("Options"),c.append("div").attr("class","remove").html("&#10006;").on("click",h),d("update-always","Always update automatically"),d("update-smart","Smart update (on mouse still)"),d("update-manual","Manual update"),c.select("#update-"+r.updateMode()).property("checked",!0),c.append("div").attr("class","close-options button").text("Close").on("click",h)},t.addDataName=function(e){a+=1;if(a===1)s.select(".data-name").text(e+".");else if(a===2){var n=s.select(".data-name"),i=n.text();i=i.slice(0,i.length-1),n.html(""),n.append("select").on("change",function(){d(this.value),r.changeDataName(this.value)}),t.addDataName(i),a-=1,d(i)}a>1&&s.select(".data-name select").append("option").attr("value",e).text(e)},t.needsUpdate=function(e){f=e,e&&s.select(".statistics").style("display","block"),s.select(".update.action.button").classed("active",e),s.select(".cancel.button").style("display",e?null:"none")},t.updating=function(e){i.style("opacity",e?.3:null),s.classed("updating",e)},t.updated=function(e){d(e),t.needsUpdate(!1),t.updating(!1)}})})();