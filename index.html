<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Binfo</title>
    <link rel="stylesheet" type="text/css" href="binfo.css">

<style>

@import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,700);

body {
  font-family: "Helvetica Neue";
  margin: 40px auto;
  width: 960px;
  min-height: 2000px;
}

#body {
  position: relative;
}

footer {
  padding: 2em 0 1em 0;
  font-size: 12px;
}

h1 {
  font-size: 96px;
  margin-top: .3em;
  margin-bottom: 0;
}

h1 + h2 {
  margin-top: 0;
}

h2 {
  font-weight: 400;
  font-size: 28px;
}

h1, h2 {
  font-family: "Yanone Kaffeesatz";
  text-rendering: optimizeLegibility;
}

#body > p {
  line-height: 1.5em;
  width: 640px;
  text-rendering: optimizeLegibility;
}

#charts {
  padding: 10px 0;
}

</style>

  </head>

  <body>
  <div id="body">

    <h1>Binfo</h1>

    <h2>Multivariate Analysis Tool using Crossfilter and D3</h2>

    <p>
    This is the <a href="http://square.github.com/crossfilter/">Crossfilter's</a>
    home page demo generalized so you can more easily fit it to your data.
    </p>
    <p>
    I can't thank Mike Bostock (<a href="https://github.com/mbostock">mbostock</a>)
    enough for the awesome <a href="http://square.github.com/crossfilter/">Crossfilter</a>
    and <a href="http://d3js.org/">D3</a> libraries that this is built on.
    </p>


    <div id="charts">
      <div id="hour-chart" class="chart">
        <div class="title">Time of Day</div>
      </div>
      <div id="delay-chart" class="chart">
        <div class="title">Arrival Delay (min.)</div>
      </div>
      <div id="distance-chart" class="chart">
        <div class="title">Distance (mi.)</div>
      </div>
      <div id="date-chart" class="chart">
        <div class="title">Date</div>
      </div>
    </div>

    <aside id="totals"><span id="active">-</span> of <span id="total">-</span> flights selected.</aside>

    <footer>
      <span style="float:right;">
        Released under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.
      </span>
      Copyright 2012 Jake Sandlund
    </footer>

  </div>
  <a href="https://github.com/jakesandlund/binfo"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a>
  </body>

  <script src="crossfilter.v1.min.js"></script>
  <script src="d3.v2.min.js"></script>
  <script src="binfo.js"></script>

<script>

// (It's CSV, but GitHub Pages only gzip's JSON at the moment.)
d3.csv("flights-3m.json", function(flights) {

  // A little coercion, since the CSV is untyped.
  flights.forEach(function(d, i) {
    d.index = i;
    d.date = parseDate(d.date);
    d.delay = +d.delay;
    d.distance = +d.distance;
  });

  // Like d3.time.format, but faster.
  function parseDate(d) {
    return new Date(2001,
        d.substring(0, 2) - 1,
        d.substring(2, 4),
        d.substring(4, 6),
        d.substring(6, 8));
  }

  // Create the crossfilter for the relevant dimensions and groups.
  var flight = crossfilter(flights),
      date = flight.dimension(function(d) { return d3.time.day(d.date); }),
      dates = date.group(),
      hour = flight.dimension(function(d) { return d.date.getHours() + d.date.getMinutes() / 60; }),
      hours = hour.group(Math.floor),
      delay = flight.dimension(function(d) { return Math.max(-60, Math.min(149, d.delay)); }),
      delays = delay.group(function(d) { return Math.floor(d / 10) * 10; }),
      distance = flight.dimension(function(d) { return Math.min(1999, d.distance); }),
      distances = distance.group(function(d) { return Math.floor(d / 50) * 50; });

  var charts = [

    barChart()
        .dimension(hour)
        .group(hours)
      .x(d3.scale.linear()
        .domain([0, 24])
        .rangeRound([0, 10 * 24])),

    barChart()
        .dimension(delay)
        .group(delays)
      .x(d3.scale.linear()
        .domain([-60, 150])
        .rangeRound([0, 10 * 21])),

    barChart()
        .dimension(distance)
        .group(distances)
      .x(d3.scale.linear()
        .domain([0, 2000])
        .rangeRound([0, 10 * 40])),

    barChart()
        .dimension(date)
        .group(dates)
        .round(d3.time.day.round)
      .x(d3.time.scale()
        .domain([new Date(2001, 0, 1), new Date(2001, 3, 1)])
        .rangeRound([0, 10 * 90]))
        .filter([new Date(2001, 1, 1), new Date(2001, 2, 1)])

  ];

  renderCharts(charts, flight);

});

</script>

</html>

