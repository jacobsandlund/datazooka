var binfo={numGroups:35,tickSpacing:46,compareHeightScale:.2,chartHeight:200,chartPadding:5,chartBorder:5,maxLevels:50,arrangeSnap:75,holderMargin:15,compareLevels:100,axisTickSize:12,axisLabelSize:14,fitWidthMaxDiff:220,chartDimensions:{top:16,right:10,bottom:20,left:10,height:100,width:100,binWidth:11}};binfo._register=function(){"use strict";function s(e){return t[e]=t[e]||o()}function o(){return{dependency:s}}var e=[],t={},n={},r={},i={};return function(o,u,a){function c(e){return!i[e]}function h(e){var s=r[e],o=n[e],u;if(i[e])return;if(o.some(c))return;u=[e].concat(o).map(function(e){return t[e]}),r[e].apply(null,u),i[e]=!0,l=!0}var f=e,l=!0;f.push(o),s(o),u.forEach(function(e){s(e)}),n[o]=u,r[o]=a,i[o]=!1;while(f.some(c)&&l)l=!1,f.forEach(h)}}(),binfo._register("core",[],function(e){function N(e,t){return e.filter(function(e){return t.indexOf(e)<0})}function C(){c!==null&&(clearTimeout(c),c=null)}function k(){c=setTimeout(function(){e.update("always")},700)}function L(){A(p,"filter"),A(p,"given"),A(p,"filterLevels"),p=null,d=!1}function A(e,t){var n,r=e[t];for(n in r)r.hasOwnProperty(n)&&T[n][t](r[n])}function O(){m=!1,v=!1,t.updated(b)}var t=e.dependency("ui"),n=e.dependency("rendering"),r=e.dependency("charts"),i=e.dependency("hash"),s=e.dependency("arrange"),o=e.dependency("stylesheet"),u={},a,f,l="always",c=null,h,p,d,v=!0,m,g,y,b,w=[],E,S,x,T;e.isMouseOut=function(){var e=d3.event,t=e.currentTarget,n;n=e.relatedTarget;if(n){while(n!==t&&n.nodeName!=="BODY")n=n.parentNode;if(n===t)return!1}return!0},e.dataSet=function(n,i,s){var o,a;if(!i)return o=u[n],o?o:null;u[n]=o={definitions:i,data:s},o.definitionIds=[],o.charts={};for(a in i)i.hasOwnProperty(a)&&(o.charts[a]=r.barChart(i[a],s),o.definitionIds.push(a));o.chartIds=o.definitionIds.slice(),t.addDataName(n),h&&h[0]===n&&e.renderFresh.apply(null,h)},binfo.setup=function(e){var n=d3.select(e.holder).attr("class","outer-holder"),r=n.append("div"),i=d3.select(e.root),u=d3.select(e.header);t.setup(r,u),s.setup(i,n,r),o.setup(r),i.on("mousemove.core",function(){c!==null&&(C(),k())})},e.dataName=function(e){if(!arguments.length)return b;if(e===b)return;v=!0,S=e,T=u[S].charts,x=[]},e.addChart=function(t){if(x.indexOf(t)>=0)return;e.chartIds(x.concat([t])),e.update()},e.removeChart=function(t){var n=x.slice();n.splice(n.indexOf(t),1),e.chartIds(n),e.update()},e.changeDataName=function(t){e.dataName(t),e.update()},e.clearCharts=function(){e.chartIds([]),e.update()},e.cancel=function(){S=b,T=E,x=w,O()},e.chartIds=function(e){if(!arguments.length)return w;x=e,x.forEach(function(e){T[e]||(T[e]=r.compareChart({id:e,charts:T}))}),y=N(w,x),g=N(x,w);if(g.length||y.length)v=!0},binfo.defaultRender=function(t,n,r){h||e.renderFresh(t,n,r)},e.renderFresh=function(t,n,r){if(!u[t]){h=[t,n,r];return}e.dataName(t),e.chartIds(n),d=!0,p=r||{filters:{},given:{},filterLevels:{}},e.update("force")},e.updateMode=function(e){if(!arguments.length)return l;l=e},e.update=function(r){r||(r=l);if(!v&&r!=="force")return;if(r==="manual"){t.needsUpdate(!0);return}C();if(!a||S!==b||y.length||g.length){if(r==="smart"){t.needsUpdate(!0),k();return}if(!m){m=!0,t.updating(!0),setTimeout(function(){e.update(r)},30);return}}i.disable();var o=u[S].data,c=g,h=y;if(!a||S!==b||y.length)a=crossfilter(o),f=a.groupAll(),c=x,h=w,y.length||(g=c,y=h);d&&(g=x,y=w),h.forEach(function(e){E[e].removeCross()}),c.forEach(function(e){T[e].addCross(a,f)}),y.forEach(function(e){E[e].remove()}),g.forEach(function(e){T[e].add()}),n.render(x,T),d&&L(),n.refresh(f.value(),a.size()),s.remove(y,E),s.add(g,T),b=S,E=T,w=x,i.refresh(b,w,E),O()},e.refresh=function(){n.refresh(f.value(),a.size()),i.refresh(b,w,E)}}),binfo._register("arrange",["core"],function(e,t){function p(){var e=o.chart;u.style("display","none"),a.style("display","none"),e.div.classed("arranging",!1),l.node().onselectstart=function(){return!0},o=null}function d(){var e=d3.mouse(f),t=e[0]+f.scrollLeft,n=e[1]+f.scrollTop;return[t,n]}function v(e,t){var n=o.chart,r=o.offsetX,i=o.offsetY,f,l,c=Math.abs,h=binfo.arrangeSnap;u.left=e-r,u.top=t-i,L(u),f=a.left-u.left,l=a.top-u.top,n.snapped&&(c(f)>h||c(l)>h)&&S(n),n.snapped||(n.left=u.left,n.top=u.top,L(n),g(n)),s=!0}function m(e){var t=Math.round(u.top/binfo.chartHeight),n,r=1e10;return t<0&&(t=0),t>=h.length&&(t=h.length-1),y(t,e.levels,function(e){var t=Math.abs(e-u.left);t<r&&(r=t,n=e)}),C(a,n,t),{level:t,left:n,diff:r}}function g(e){var t=m(e),n=t.level,r=t.left,i=t.diff;if(Math.abs(n*binfo.chartHeight-u.top)>=binfo.arrangeSnap)return;if(i>=binfo.arrangeSnap)return;var s=null;y(n,e.levels,function(e,t){e>r&&s===null&&(s=t)},function(t){s===null&&(s=t.length),t.splice(s,0,e),s=null}),b(),k(e,!0),C(e,r,n),T(e)}function y(e,t,n,r){var i,s,o,u;for(i=e;i<e+t;i++){s=h[i];for(o=0;o<s.length;o++)u=s[o].left+s[o].width,n(u,o);r&&r(s)}}function b(){var e,t,n=0;for(e=0;e<h.length;e++)h[e].length>1&&(n=e);t=h[n],i=0;for(e=1;e<t.length;e++)i=Math.max(i,t[e].startLevel)}function w(e,t){var n,r,i;for(r=e.startLevel;r<e.startLevel+e.levels;r++){n=h[r];for(i=1;i<n.length;i++)if(n[i]===e){t(n,i);break}}}function E(e){var t=[];return w(e,function(e,n){var r=e[n+1];r&&t.indexOf(r)<0&&t.push(r)}),t}function S(e){var t=E(e);w(e,function(e,t){e.splice(t,1)}),k(e,!1),x(t)}function x(e){e.forEach(function(e){N(e)})}function T(e){x(E(e))}function N(e){var t=0;w(e,function(e,n){t=Math.max(t,e[n-1].left+e[n-1].width)}),t!==e.left&&(e.left=t,L(e),T(e))}function C(e,t,n){e.left=t,e.startLevel=n,e.top=n*binfo.chartHeight,L(e)}function k(e,t){e.snapped=t,e.div.classed("unsnapped",!t),a.style("border-color",t?"#eee":"red")}function L(e){e.div.style("left",e.left+"px").style("top",e.top+"px")}var n,r,i,s,o,u,a,f,l,c=1,h;e.setup=function(e,t,s){l=e,n=t,r=s,f=r.node(),u=r.append("div").attr("class","ghost").style("display","none"),u.div=u,a=r.append("div").attr("class","positioner").style("display","none"),a.div=a,i=0,h=[];var c={left:binfo.holderMargin,width:0,levels:0},m;for(m=0;m<binfo.maxLevels;m++)h[m]=[c];l.on("mousemove.arrange",function(){var e=d();o&&v.apply(null,e)}),l.on("mouseup.arrange",function(){o&&p()})},e.start=function(e){var t=d();l.node().onselectstart=function(){return!1},c+=1,e.div.style("z-index",c),u.width=e.width,u.height=e.height-binfo.chartBorder/2,u.left=e.left,u.top=e.top,a.height=e.height+binfo.chartBorder,u.levels=e.levels,u.style("display","block").style("width",u.width+"px").style("height",u.height+"px"),L(u),a.style("display","block").style("height",a.height+"px"),m(e),e.div.classed("arranging",!0),o={chart:e,offsetX:t[0]-e.left,offsetY:t[1]-e.top}},e.remove=function(e,t){e.forEach(function(e){S(t[e])}),b(),s=!0},e.add=function(e,t){var n=window.innerWidth-binfo.holderMargin-binfo.chartBorder;e.forEach(function(e){var r=t[e],s=r.levels,o=r.width,u,a,f,l=0,c,p,d,v=-1,m=i,g;while(m<h.length){f=h[m][h[m].length-1],u=f.left+f.width,a=n-u,a>=o||a===n?l?(p=Math.abs(a-c),p<=binfo.fitWidthMaxDiff?(l+=1,c=Math.min(a,c)):(c=a,l=1)):(c=a,l=1):l=0;if(l===s)break;m===0&&v===-1&&(v=1,m=i-s,m<0&&(m=-1),l=0),m+=v}d=v===1?m-s+1:m;for(g=d;g<d+s;g++)h[g].push(r);i=Math.max(d,i),k(r,!0),C(r,n-c,d)}),b(),s=!0},e.orderedChartIds=function(e,t){if(!s)return null;var i,o=[];i=e.map(function(e){return t[e]}),i.sort(function(e,t){return e.top===t.top?e.left-t.left:e.top-t.top});var u=i[i.length-1],a=u.top+u.height,f=a+820;return r.style("height",f+"px"),n.style("height",f+30+"px"),s=!1,i.map(function(e){return e.id})}}),binfo._register("charts",["core","logic","arrange"],function(e,t,n,r){"use strict";function i(e,t){typeof t=="number"&&(t+="px");var n=d3.select(".holder").append("span").style("font-size",t).text(e),r=n.property("offsetWidth");return n.remove(),Math.ceil(r)}function s(e){var t=e.dimensions||{},n=binfo.chartDimensions,r;for(r in n)n.hasOwnProperty(r)&&(t[r]||(t[r]=n[r]));return t}function o(e){var t={};return t.left=e.left,t.right=e.right,t.bottom=e.bottom,t.top=e.top,t}function u(e,n){n.div=e;var i=e.select(".title").text(n.label).style("display","none");e.append("div").attr("class","remove").html("&#10006;").on("click",function(){t.removeChart(n.id)}),e.on("mousedown",function(){var t=d3.event.target;if(t!==e.node()&&t!==i.node())return;r.start(n)})}function a(e,t,n){var r=t.actualHeight||t.height,i=t.left+t.right,s=t.top+t.bottom;n?(i+=r,s+=t.width):(i+=t.width,s+=r);var o=e.append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+t.left+","+t.top+")");return n&&o.attr("transform","matrix(0,1,-1,0,"+(t.actualHeight+t.left)+","+t.top+")"),o}function f(e,t){var n=e.property("offsetWidth")-binfo.chartBorder,r=n-binfo.chartPadding*2-binfo.chartBorder,i,s;t.width=n,e.style("width",r+"px"),e.select(".title").style("width",r-15+"px").style("display",null),i=e.property("offsetHeight")-binfo.chartBorder-5,s=Math.ceil(i/binfo.chartHeight),t.levels=s,t.height=s*binfo.chartHeight,i=t.height-(binfo.chartBorder+2*binfo.chartPadding),t.snapped=!1,e.style("height",i+"px")}function l(e,t,n){e.on("brush",function(){var r=d3.select(this.parentNode),i=e.extent();n&&(i&&Array.isArray(i[0])?i=i.map(function(e){return e.map(n)}):i=i.map(n),r.select(".brush").call(e.extent(i))),e.empty()||t(i)}),e.on("brushend",function(){e.empty()&&t(null)})}function c(e,t){t=t||30;var n=+(e==="e"),r=n?1:-1,i=Math.min(t,30),s=t/2-i/2;return"M"+.5*r+","+s+"A6,6 0 0 "+n+" "+6.5*r+","+(s+6)+"V"+(s+i-6)+"A6,6 0 0 "+n+" "+.5*r+","+(s+i)+"Z"+"M"+2.5*r+","+(s+i/4)+"V"+(s+i-i/4)+"M"+4.5*r+","+(s+i/4)+"V"+(s+i-i/4)}function h(e,t,n){var r=e.append("g").attr("class","brush").call(t);n&&r.selectAll("rect").attr("height",n);var i=n?c:function(){return"M0,0"};return r.selectAll(".resize").append("path").attr("d",function(e){return i(e,n)}),r}function v(e,n){function N(n){e.api.filter(n),t.refresh()}function C(t,n,r){var i=r.orientFlip,s=r.compare,o,u;typeof i=="undefined"&&(i=v),u=t.append("g"),s&&u.attr("transform","scale(1,"+m+")"),d+=1,u.append("clipPath").attr("id","clip-"+d).attr("class","clip-"+e.api.id).append("rect").attr("width",n.width).attr("height",n.height),u.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(e){return e+" bar"}),u.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+d+")"),o=t.append("g").attr("class","axis"),e.ordinal?(o.attr("transform","matrix(0,-1,1,0,0,"+n.actualHeight+")").classed("ordinal",!0),o.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",n.width),o.selectAll("text").data(e.ordinal()).enter().append("text").attr("y",function(e,t){return(t+.9)*n.binWidth}).attr("x",-6).text(function(e){return e})):i?(E.orient("left"),o.attr("transform","matrix(0,-1,1,0,0,"+n.actualHeight+")").call(E)):(E.orient("bottom"),o.attr("transform","translate(0,"+n.actualHeight+")").call(E));var a=h(t,S,n.actualHeight);i&&a.selectAll(".resize").style("cursor","ns-resize")}function k(t,n){function s(){var t=d3.select(this);e.filterActive()?N(null):N(!0)}function o(){var e=[];i.selectAll(".range").each(function(){e.push(this.value)});var t=g(e[0]),r=g(e[1]);t<=r&&r>=0&&t<=n.width&&N(e),u(!1)}function u(e){e?r.classed("down",!1).text("Update").on("click",o):(r.on("click",s),L(t))}var r,i=t.append("div").attr("class","peripherals filter-bar");r=i.append("div").attr("class","filter button"),u(!1),i.selectAll(".range").data(["left","right"]).enter().append("input").attr("type","text").attr("class",function(e){return"range "+e}).property("value",function(t,n){return e.filterRange()[n]}).on("keydown",function(){d3.event.keyCode===13?o():u(!0)})}function L(t){var n=e.filterActive();t.select(".filter.button").text(n?"Reset":"Filter").classed("down",n)}function A(t,n,i){var s,o,u,a=i.compare;T&&(n.selectAll(".brush").call(S),a||(L(t),t.selectAll(".range").property("value",function(t,n){return e.filterRange()[n]})),e.filterActive()?(u=S.extent(),n.selectAll(".clip-"+e.api.id+" rect").attr("x",g(u[0])).attr("width",g(u[1])-g(u[0])),a||(s=n.selectAll(".percent").data([1]),s.enter().append("text").attr("class","percent").attr("y",-4),s.attr("x",(g(u[1])+g(u[0]))/2))):(n.selectAll(".clip-"+e.api.id+" rect").attr("x",0).attr("width",r.width),n.selectAll(".percent").data([]).exit().remove())),a||(o=e.percent(),s=n.selectAll(".percent").text(p(o))),n.selectAll(".bar").attr("d",x)}var r=s(n),c=o(r),v=!1,m=n.compareHeightScale||binfo.compareHeightScale,g=n.x,y=n.y||d3.scale.linear().range([r.height,0]),b=n.tickSpacing||binfo.tickSpacing,w=n.ticks,E=d3.svg.axis(),S=d3.svg.brush(),x,T;n.tickSpacing===!1&&(b=!1),r.compareHeight=r.height*m,e.ordinal&&(v=!0),e.api.label=n.label,e.api.defaultOrientFlip=v,e.api.dim=r,r.labelWidth=i(e.api.label,binfo.axisLabelSize),l(S,N,e.round),e.updateChart=function(){var t=e.rawGroups(),n=[],i=-1,s=t.length,o=r.height,u=r.binWidth-1,a;y.domain([0,e.maxY()]);while(++i<s)a=t[i],n.push("M",g(a.key),",",o,"V",y(a.value),"h",u,"V",o);x=n.join("")},e.api.render=function(){var t=d3.select(this),n,i,s,o=t.datum(),l=o.orientFlip,h=o.compare,p,d;typeof l=="undefined"&&(l=v),h?(n=t,p=n.select("path")):(i=t,n=i.select("g"),p=n);if(p.empty()){l?s={top:r.left,right:r.top,bottom:r.right,left:r.bottom}:s={};for(d in r)r.hasOwnProperty(d)&&typeof s[d]=="undefined"&&(s[d]=r[d]);l&&!e.ordinal&&(s.left=c.left+r.maxTickWidth),s.actualHeight=h?s.compareHeight:s.height,h||(u(i,e.api),n=a(i,s,l)),C(n,s,o),h||(k(i,s),f(i,e.api))}A(i,n,o)},e.addChart=function(){var t=e.minX(),s=e.maxX(),o;n.x||(n.type==="date"?g=d3.time.scale():g=d3.scale.linear(),g.domain([t,s]).rangeRound([0,e.api.numGroups()*r.binWidth])),e.x=g,e.ordinal||(E.scale(g),n.format&&E.tickFormat(n.format)),S.x(g),r.width=g.range()[1];if(w||b)o=e.ticks||Math.round(r.width/b),E.ticks(o);var u=0,a,f,l,h=0;e.ordinal?(e.ordinal().forEach(function(e){u=Math.max(u,i(e,binfo.axisTickSize))}),r.bottom=c.bottom+u,r.maxTickWidth=0):(a=E.tickFormat()||g.tickFormat(),o=E.tickValues()||g.ticks(o||binfo.numGroups),f=i(a(o[0])),l=i(a(o[o.length-1])),o.forEach(function(e){h=Math.max(h,i(a(e)))}),r.left=c.left+Math.ceil(f/2),r.right=c.right+Math.ceil(l/2),r.maxTickWidth=h)},e.chartFilter=function(){var t=e.filterActive()?e.filterRange():null;t?S.extent(t):S.clear(),T=!0},e.resetUpdateChart=function(){T=!1}}function m(e,n){function x(t){e.api.filter(t)}function T(t){var n=e.api.div.select("g.compare");b=t,t?L(n):A(n)}function N(n){e.api.given(n),t.refresh()}function C(e){var n;return e.append("g").attr("class","yc inner-chart").datum({compare:!0,orientFlip:!0}).attr("transform","matrix(0,1,-1,0,"+r.yHeight+","+r.yTop+")"),e.append("g").attr("class","xc inner-chart").attr("transform","translate("+r.xLeft+","+r.xTop+")").datum({compare:!0,orientFlip:!1}),n=e.append("g").attr("class","compare").attr("transform","translate("+r.xLeft+","+r.yTop+")").on("mousemove",function(){L(n)}).on("mouseout",function(){t.isMouseOut()&&A(n)}),n.selectAll(".compare.level").data(S).enter().append("path").attr("class",function(e){return"level-"+e+" compare level"}),n.append("text").attr("class","compare percent").attr("transform","translate("+r.xWidth/2+",-5)"),n.append("rect").attr("class","hover").style("display","none"),h(n,v),e.append("g").attr("transform","translate("+(-r.left+7)+","+r.yWidth/2+") rotate(90)").append("text").attr("class","axis-label").text(d.label),e.append("text").attr("x",r.xLeft+r.xWidth/2).attr("y",r.height+r.bottom-8).attr("class","axis-label").text(c.label),e}function k(t){var n=d3.mouse(t.node()),i=n[0]-1,s=n[1]-1;return i<0||s<0?null:(i=Math.floor(i/r.binWidth),s=Math.floor(s/r.binWidth),i>=e.xcNumGroups()||s>=e.ycNumGroups()?null:{xi:i,yi:s})}function L(e){b&&O(e,k(e))}function A(e){O(e,null)}function O(t,n){var i=t.select("rect.hover"),s=r.binWidth,o,u;i.style("display",n?null:"none");if(!n){D();return}o=n.xi,u=n.yi,i.attr("x",o*s).attr("y",u*s).attr("width",s).attr("height",s),D(e.stats([[o,u],[o+1,u+1]]))}function M(t){function m(t){e.api.filterLevels(t)}var n,i,s,o,u,a,f,c,p,d=d3.svg.brush(),v;o=16,u=2,f=30,i=16,s=10,a=y*u,p=d3.scale.linear().domain([0,100]).range([a-1,0]),c=d3.svg.axis().scale(p).orient("right"),d.x(p),l(d,m,Math.round),n=t.append("svg").attr("class","legend").attr("height",a+2*i).attr("width",o+f+s).append("g").attr("transform","translate("+s+","+i+")"),n.append("text").attr("class","axis-label").attr("x",o/2).attr("y",-6).text("Level"),n.append("g").attr("transform","translate("+o+",0)").attr("class","axis").call(c),n.selectAll("rect.level").data(S).enter().append("rect").attr("class",function(e){return"level level-"+e}).attr("x",0).attr("y",function(e,t){return a-(t+1)*u}).attr("width",o).attr("height",u);var g=h(n,d,o).attr("transform","rotate(90) translate(0,"+ -o+")");g.selectAll(".resize").style("cursor","ns-resize"),e.updateLegend=function(t){t?d.extent(t):(d.clear(),t=[0,100]),g.call(d),e.api.div.selectAll(".level").each(function(e){d3.select(this).classed("level-fade-"+e,e<t[0]||e>=t[1])})},e.updateLegend(E),v=t.append("div").attr("class","peripherals given-bar").style("width",r.width+"px").style("margin-left",r.left+r.xLeft+"px"),v.append("div").attr("class","words").text("Given"),v.append("div").attr("class","xc given button"),v.append("div").attr("class","words").text("or"),v.append("div").attr("class","yc given button"),v.selectAll(".given.button").data(["xc","yc"]).text(function(t){return e[t].label}).classed("down",function(t){return e.api.given()===t}).on("click",function(t){var n=d3.select(this);e.api.given()===t?N(null):N(t)})}function _(t,n){n.selectAll(".yc.inner-chart").each(d.render),n.selectAll(".xc.inner-chart").each(c.render),n.selectAll(".compare.level").attr("d",function(e){return g[e]}),t.selectAll(".given.button").classed("down",function(t){return e.api.given()===t}),D()}function D(t){var n=e.api.div.select("g.compare"),t=t||e.filterStats(),r="";t&&(r=p(t.percent)+" (Lvl: "+t.level+")"),n.select("text.percent").text(r)}var r=s(n),i=o(r),c=e.xc,d=e.yc,v=d3.svg.brush(),m,g=[],y=binfo.compareLevels,b=!0,w,E,S=[];e.api.label=c.label+" vs. "+d.label;for(w=0;w<y;w++)S.push(w);l(v,x,e.round),v.on("brushstart.compare",function(){T(!1)}),v.on("brushend.compare",function(){T(!0)}),e.updateChart=function(){var t=e.levelsMatrix(),n=t.length,i=t[0].length,s=[],o,u,a,f=r.binWidth,l,c;for(o=1;o<y;o++)s[o]=[];s[-1]=s[0]={push:function(){},join:function(){return m}};for(o=0;o<n;o++){l=o*f;for(u=0;u<i;u++)c=u*f,a=t[o][u],s[a].push("M",l,",",c,"v",f,"h",f,"v",-f)}for(o=0;o<y;o++)g[o]=s[o].join("")||"M0,0"},e.api.render=function(t){var t=d3.select(this),n=t.select("g");n.empty()&&(u(t,e.api),n=a(t,r,!1),t.select("svg").attr("class","compare"),C(n),M(t),f(t,e.api)),_(t,n)},e.chartLevels=function(t){E=t,e.updateLegend&&e.updateLegend(t)},e.addChart=function(){var t;r.left=d.dim.bottom+d.dim.maxTickWidth+14,r.bottom=c.dim.bottom+14+(c.ordinal?0:10),r.xHeight=c.dim.compareHeight,r.yHeight=d.dim.compareHeight,r.xWidth=c.dim.width,r.yWidth=d.dim.width,t=Math.ceil((c.dim.labelWidth-c.dim.width)/2),r.right=Math.max(r.right,t),r.left=Math.max(r.left,t-r.yHeight),t=Math.ceil((d.dim.labelWidth-d.dim.width)/2),r.top=Math.max(r.top,t),r.bottom=Math.max(r.bottom,t-r.xHeight),r.xTop=r.yWidth+4,r.xLeft=r.yHeight+2,r.yTop=2,r.width=r.yHeight+r.xWidth+4,r.height=r.yWidth+r.xHeight+4,r.actualHeight=r.height,m="M-1,-1V"+(r.xTop-r.yTop-2)+"H"+(r.width-r.xLeft-2)+"V-1H-1";var n=d3.scale.linear().domain([0,e.xcNumGroups()]).range([0,e.xcNumGroups()*r.binWidth]),i=d3.scale.linear().domain([0,e.ycNumGroups()]).range([0,e.ycNumGroups()*r.binWidth]);v.x(n).y(i)},e.api.cleanUp=function(){},e.chartFilter=function(t){t?v.extent(t):v.clear(),e.api.div&&(e.api.div.selectAll("g.compare .brush").call(v),D())}}e.barChart=function(e,t){var r={api:{}};return n.barLogic(r,e,t),v(r,e),r.api},e.compareChart=function(e){var t={api:{}};return n.compareLogic(t,e),m(t,e),t.api};var p=d3.format(".3p"),d=0}),binfo._register("logic",["hash"],function(e,t){"use strict";e.barLogic=function(e,t,n){function C(e){return function(t){return Math.floor(t/e)*e}}function k(e){return function(t){return Math.round(t/e)*e}}function L(t){var n=1e9,r={},i,s=[];if(e.ordinal){t.forEach(function(e){e=c(e);var t=r[e];if(typeof t!="undefined")return;t=b(e);if(t>=0){r[e]=t;return}r[e]=n,n++});for(i in r)r.hasOwnProperty(i)&&s.push({value:i,order:r[i]});s.sort(function(e,t){return e.order-t.order}),s.forEach(function(e,t){y[e.value]=t,g[t]=E(e.value)})}}var r=0,i=0,s,o,u,a,f,l,c,h,p,d,v,m,g=[],y={},b,w={},E,S=t.minX,x=t.maxX,T=t.maxY,N=t.separation;e.api.id=t.id,e.round=t.round,e.round&&typeof e.round=="number"&&(e.round=k(e.round)),l=t.dimension||function(t){return t[e.api.id]},t.ordinal&&(N=1,e.round=Math.round,Array.isArray(t.ordinal)?t.ordinal.forEach(function(e,t){w[e]=t}):w=t.ordinal,typeof w=="object"?b=function(e){var t=w[e];return!t&&t!==0?-1:t}:typeof t.ordinal=="function"?b=t.ordinal:b=function(){return-1},c=l,l=function(e){return y[c(e)]},E=t.format||function(e){return e});if(t.group)v=t.group;else if(t.groupBy)N=N||t.groupBy,v=C(N);else if(t.groupIdentity||t.ordinal)v=function(e){return e};t.ordinal&&(e.ordinal=function(){return g},e.api.ordinal=!0),e.api.dimensionFunc=function(){return l},e.api.groupFunc=function(){return v},e.api.groups=function(){return p},e.rawGroups=function(){return d},e.minX=function(){return S},e.maxX=function(){return x},e.maxY=function(){return T},e.filterActive=function(){return u},e.filterRange=function(){return o},e.percent=function(){return a.value()/m.value()},e.api.numGroups=function(){return p.length},e.api.groupIndex=function(e){return Math.floor((e-S)/N)},L(n),e.api.filter=function(t){return arguments.length?(t?(u=!0,t===!0?t=o:o=t,f&&(+t[0]===+t[1]?f.filterExact(t[0]):f.filterRange(t))):(u=!1,f&&f.filterAll()),e.chartFilter(),e):u?o:null},e.api.addCross=function(n,r){i+=1;if(i>1)return;a=r,f=n.dimension(l);if(!v){var s=f.top(Infinity),o=+l(s[0]),c=+l(s[s.length-1]),g=Math.abs(o-c),y=d3.scale.linear().domain([0,g]),b=y.ticks(t.numGroups||binfo.numGroups);N=b[1]-b[0],v=C(N)}h=f.group(v),d=h.all(),m=f.groupAll(),t.minX||(S=+d[0].key),t.maxX||(x=+d[d.length-1].key+N);var w={value:0},E,T=0,k,L;p=[];for(E=0;E<d.length;E++){k=e.api.groupIndex(d[E].key);for(;T<k;T++)p.push(w);p.push(d[E]),T+=1}L=Math.round((x-S)/N);for(;T<L;T++)p.push(w);e.api.filter(u)},e.api.add=function(){r+=1,e.chartFilter();if(r>1)return;e.addChart();if(!o){var t=e.x.ticks(20),n=t[Math.round(t.length*.3)],i=t[Math.round(t.length*.7)];e.round&&(n=e.round(n),i=e.round(i)),o=[n,i]}},e.api.removeCross=function(){i-=1},e.api.remove=function(){r-=1,r||e.api.filter(null)},e.api.update=function(){if(s)return;s=!0,t.maxY||(T=h.top(1)[0].value),e.updateChart()},e.api.resetUpdate=function(){if(!s)return;s=!1,e.resetUpdateChart()},e.api.addToParams=function(t){t.filter[e.api.id]=e.api.filter()}},e.compareLogic=function(e,n){function k(t){e.api[t]=function(){i[t](),s[t]()}}var r=n.id.split("-"),i=n.charts[r[0]],s=n.charts[r[1]],o=null,u,a,f,l,c,h,p,d,v,m,g,y=binfo.compareLevels,b=Math.pow(2,20),w,E,S,x,T,N,C;e.api.id=n.id,e.xc=i,e.yc=s,e.levelsMatrix=function(){return g},e.xcNumGroups=function(){return p},e.ycNumGroups=function(){return d},e.filterStats=function(){return S},e.round=Math.round,e.api.given=function(e){if(!arguments.length)return o;o=e},e.api.filter=function(n){if(!arguments.length)return E;E=n,S=e.stats(E),t.refreshParams(),e.chartFilter(E)},e.api.filterLevels=function(n){if(!arguments.length)return x;x=n,t.refreshParams(),e.chartLevels(n)},w=function(e){var t=i.groupIndex(c(f(e))),n=s.groupIndex(h(l(e)));return t+n*b},e.api.addToParams=function(t){t.filterLevels[e.api.id]=x,t.given[e.api.id]=o,t.filter[i.id]=i.filter(),t.filter[s.id]=s.filter()},e.api.addCross=function(e,t){u=t,i.addCross(e,u),s.addCross(e,u),f=i.dimensionFunc(),l=s.dimensionFunc(),c=i.groupFunc(),h=s.groupFunc(),v=i.groups(),m=s.groups(),p=i.numGroups(),d=s.numGroups();var n=e.dimension(w);T=n.group(),N=T.all();var r;C=[],g=[];for(r=0;r<p;r++)C[r]=[],g[r]=[]},e.api.add=function(){i.add(),s.add(),e.addChart()},e.stats=function(e){if(!e)return null;var t=e[0][0],n=e[0][1],r=e[1][0],i=e[1][1],s,a,f,l,c,h,y,b,w,E,S;c=0,b=0,f=r-t+1,l=i-n+1,w=f*l;for(s=t;s<r;s++)for(a=n;a<i;a++)c+=C[s][a],b+=g[s][a];S=Math.round(b/w);if(!o)E=c/u.value();else if(o==="yc"){c=0;for(a=n;a<i;a++){h=m[a].value;if(h){y=0;for(s=t;s<r;s++)y+=C[s][a]/h}else y=f/p;c+=y}E=c/l}else{c=0;for(s=t;s<r;s++){h=v[s].value,y=0;if(h)for(a=n;a<i;a++)y+=C[s][a]/h;else y=l/d;c+=y}E=c/f}return{level:S,percent:E}},["remove","removeCross","resetUpdate"].forEach(function(e){k(e)}),e.api.update=function(){i.update(),s.update();var t,n,r,u=N.length,a,f=y-1e-9,l=f/3,c,h,w,x;for(t=0;t<p;t++)for(n=0;n<d;n++)C[t][n]=0,g[t][n]=0;r=-1;while(++r<u)a=N[r],t=a.key%b,n=Math.round(a.key/b),C[t][n]=a.value;if(!o){x=f/(T.top(1)[0].value+1e-300);for(t=0;t<p;t++)for(n=0;n<d;n++)g[t][n]=Math.floor(C[t][n]*x)}else if(o==="yc")for(n=0;n<d;n++){x=p/(m[n].value+1e-300);for(t=0;t<p;t++)c=C[t][n]*x,h=Math.log(1+c)*l,w=Math.min(y-1,Math.floor(h)),g[t][n]=w}else for(t=0;t<p;t++){x=d/(v[t].value+1e-300);for(n=0;n<d;n++)c=C[t][n]*x,h=Math.log(1+c)*l,w=Math.min(y-1,Math.floor(h)),g[t][n]=w}S=e.stats(E),e.updateChart()}}}),binfo._register("setup",["core"],function(setup,core){"use strict";function checkLoaded(e){definitions[e]&&data[e]&&core.dataSet(e,definitions[e],data[e])}var definitions={},data={},untypedData={};binfo.definitionsFromJSON=function(dataName,defns){function makeEvil(e,t){return function(n){if(!e[n])return;evil.push('defns["',t,'"].',n," = ",e[n],";")}}function maybeMakeEvil(e,t){var n=makeEvil(e,t);return function(t){typeof e[t]=="string"&&e[t].slice(0,8)==="function"&&n(t)}}var id,defn,evil=[],evalParts=["dimension","group","round","x","y","format"],evalPartsIfFunc=["type","ordinal"];for(id in defns)defns.hasOwnProperty(id)&&(defn=defns[id],evalParts.forEach(makeEvil(defn,id)),evalPartsIfFunc.forEach(maybeMakeEvil(defn,id)));eval(evil.join("")),binfo.definitions(dataName,defns)},binfo.definitions=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(t[n].id=n,t[n].type=t[n].type||"number");definitions[e]=t,untypedData[e]?binfo.dataFromUntyped(e,untypedData[e]):checkLoaded(e)},binfo.dataFromUntyped=function(e,t){if(!definitions[e]){untypedData[e]=t;return}var n=definitions[e],r,i;t.forEach(function(e){for(r in n){if(!n.hasOwnProperty(r))continue;i=n[r];if(i.derived)continue;if(typeof i.type=="function"){e[r]=i.type(e[r]);return}switch(i.type){case"number":e[r]=+e[r];break;case"date":e[r]=new Date(e[r]);break;default:}}}),binfo.data(e,t)},binfo.data=function(e,t){data[e]=t,checkLoaded(e)}}),binfo._register("stylesheet",[],function(e){e.setup=function(e){function N(e,o,u){for(n=0;n<i;n++)r=s(n),t+="."+e+"-"+n+"{fill:hsl(",t+=b(r)+",",t+=o(r)+"%,",t+=u(S(r))+"%",t+=");}"}var t="",n,r,i=binfo.compareLevels,s=d3.scale.linear(),o=[],u,a=222,f=200,l=180,c=158,h=120,p=80,d=60,v=45,m=30,g=15,y=0,b=d3.scale.linear(),w=d3.scale.linear(),E=d3.scale.linear(),S=d3.scale.linear(),x=d3.scale.linear(),T=d3.scale.identity();s.domain([0,i-1]).range([0,1]),o=[{d:0,h:a,b:35},{d:.17,h:f,b:40},{d:.22,h:l,b:35},{d:.3,h:c,b:38},{d:.41,h:h,b:42},{d:.54,h:p,b:60},{d:.65,h:d,b:50},{d:.725,h:v,b:50},{d:.83,h:m,b:50},{d:.95,h:g,b:50},{d:1,h:y,b:60}],u=o.map(function(e){return e.d}),b.range(o.map(function(e){return e.h})),S.range(o.map(function(e){return e.b})),w.domain([0,1]).range([100,100]),E.domain([0,1]).range([40,40]),b.domain(u),S.domain(u),x.domain([35,60]).range([78,92]),N("level",w,T),N("level-fade",E,x),e.append("style").html(t)}}),binfo._register("hashRetrieval",["core"],function(e,t){"use strict";function n(){var e={},t,n=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s=window.location.hash.substring(1);t=r.exec(s);while(t)e[i(t[1])]=i(t[2]),t=r.exec(s);return e}function r(){var e=n(),r=e.data,s=e.charts&&e.charts.split(","),o={};o.given=i(e.given),o.filter=i(e.filter),o.filterLevels=i(e.filterLevels);if(!r||!s||!s.length)return;t.renderFresh(r,s,o)}function i(e){var t=e&&e.split(","),n={};return t&&t.forEach(function(e){var t=e.split("*"),r=t.slice(1);r.length===1&&(r=r[0]),n[t[0]]=r}),n}window.onhashchange=r,r()}),binfo._register("hash",["arrange"],function(e,t){function f(e,t){function o(e){return typeof e=="object"&&(e=e.valueOf()),encodeURIComponent(e)}var n=e[t],r,i,s=[];for(i in n)n.hasOwnProperty(i)&&n[i]&&(r=n[i],Array.isArray(r)&&(r=r.map(o).join("*")),s.push(i+"*"+r));return t+"="+s.join(",")}function l(){u=!1;var e=t.orderedChartIds(n,r);e?a=!0:e=n;if(a){s[1]="charts="+e.join(",");var i="#"+s.join("&");window.history.replaceState({},"",i),u=!0,a=!1}}var n,r,i,s=[0,0,0],o=!0,u=!1,a=!1;e.disable=function(){o=!1},e.refresh=function(t,s,u){i=t,n=s,r=u,o=!0,e.refreshParams()},e.refreshParams=function(){if(!o)return;var e={filter:{},given:{},filterLevels:{}};n.forEach(function(t){r[t].addToParams(e)}),s=["data="+i,null,f(e,"given"),f(e,"filterLevels"),f(e,"filter")],a=!0,u||l()},setInterval(l,600)}),binfo._register("rendering",["core"],function(e,t){"use strict";function s(e){return function(t){d3.select(this).each(t.chart[e])}}var n,r=d3.format(",d"),i=d3.format(".3p"),o=s("update"),u=s("render"),a=s("resetUpdate");e.refresh=function(e,t){n.each(o),n.each(u),n.each(a),d3.select(".active-data").text(r(e)),d3.select(".total").text(r(t)),d3.select(".percent-active").text(" ("+i(e/t)+")")},e.render=function(e,t){var r;r=e.map(function(e,n){return{chart:t[e]}}),n=d3.select(".holder").selectAll(".chart").data(r,function(e){return e.chart.id}),n.enter().append("div").attr("class","chart").append("div").attr("class","title"),n.exit().remove(),n.order()}}),binfo._register("ui",["core"],function(e,t){"use strict";function h(){var e=s.select(".options-panel"),t=e.style("display");e.style("display",t==="block"?"none":"block"),s.select(".options.button").classed("down",t==="none")}function p(e){e=e?null:"none",f||s.select(".statistics").style("display",e),s.select(".statistics ul").style("display",e)}function d(e){if(e===u)return;var n=t.dataSet(e),r=n.definitionIds,i=n.definitions,o,f;u=e,a>1&&s.select(".data-name select").property("value",u),o=r.map(function(e){return{id:e,label:i[e].label}}),f=s.select(".statistics ul").selectAll("li").data(o,function(e){return e.id}),f.enter().append("li").on("click",v).text(function(e){return e.label}),f.exit().remove()}function v(e){l==="compare"?c?(c!==e.id&&t.addChart(c+"-"+e.id),m()):(c=e.id,d3.select(this).classed("down",!0)):t.addChart(e.id)}function m(){c=null,s.selectAll(".statistics li.down").classed("down",!1)}function g(e){l===e&&(e=null),o&&clearTimeout(o),l=e,s.select(".compare.button").classed("down",e==="compare"),s.select(".bar.button").classed("down",e==="bar"),e?p(!0):(p(!1),m())}var n=e.dependency("rendering"),r=e.dependency("setup"),i,s,o,u,a=0,f,l,c;e.setup=function(e,n){function d(){var e=this.id.slice(7),n=e==="always";t.updateMode(e),l.style("display",n?"none":"block"),n&&t.update()}function v(e,t){var n=p.append("div");n.append("input").attr("type","radio").attr("name","update").attr("id",e).on("click",d),n.append("label").attr("for",e).text(t)}i=e,i.attr("class","holder");var r,u,a,f,l,c,p;s=n.insert("div",":first-child").attr("class","control-panel"),s.append("div").attr("class","tool title").text("Binfo"),r=s.append("div").attr("class","config"),u=r.append("div").attr("class","totals pane"),u.append("span").attr("class","active-data").text("-"),u.append("span").attr("class","percent-active").text(" (XX.X%)"),u.append("span").text(" of "),u.append("span").attr("class","total").text("-"),u.append("span").attr("class","data-name"),a=r.append("div").attr("class","interactions pane").on("mouseover",function(){o&&clearTimeout(o)}).on("mouseout",function(){t.isMouseOut()&&(o=setTimeout(g,550))}),a.append("span").text("Add"),a.append("div").attr("class","bar button").text("Bar").on("click",function(){g("bar")}),a.append("span").text("or"),a.append("div").attr("class","compare button").text("Comparison").on("click",function(){g("compare")}),a.append("span").text("charts."),f=a.append("div").attr("class","statistics").style("display","none"),f.append("ul"),l=f.append("div").attr("class","update panel").style("display","none"),l.append("div").attr("class","update action button").text("Update").on("click",function(){t.update("force")}),l.append("div").attr("class","cancel button").text("Cancel").style("display","none").on("click",t.cancel),r.append("div").attr("class","remove-all button").text("Remove All").on("click",t.clearCharts),c=s.append("div").attr("class","view-toggles pane"),c.append("div").text("Options").attr("class","options button").on("click",h),p=c.append("div").attr("class","options-panel").style("display","none"),p.append("div").attr("class","title").text("Options"),p.append("div").attr("class","remove").html("&#10006;").on("click",h),v("update-always","Always update automatically"
),v("update-smart","Smart update (on mouse still)"),v("update-manual","Manual update"),p.select("#update-"+t.updateMode()).property("checked",!0),p.append("div").attr("class","close-options button").text("Close").on("click",h)},e.addDataName=function(n){a+=1;if(a===1)s.select(".data-name").text(n+".");else if(a===2){var r=s.select(".data-name"),i=r.text();i=i.slice(0,i.length-1),r.html(""),r.append("select").on("change",function(){d(this.value),t.changeDataName(this.value)}),e.addDataName(i),a-=1,d(i)}a>1&&s.select(".data-name select").append("option").attr("value",n).text(n)},e.needsUpdate=function(e){f=e,e&&s.select(".statistics").style("display","block"),s.select(".update.action.button").classed("active",e),s.select(".cancel.button").style("display",e?null:"none")},e.updating=function(e){i.style("opacity",e?.3:null),s.classed("updating",e)},e.updated=function(t){d(t),e.needsUpdate(!1),e.updating(!1)}});